!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){module.exports=function(arr){if(Array.isArray(arr))return arr}},{}],2:[function(require,module,exports){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}module.exports=function(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}},{}],3:[function(require,module,exports){module.exports=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}},{}],4:[function(require,module,exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}module.exports=function(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}},{}],5:[function(require,module,exports){module.exports=function(obj){return obj&&obj.__esModule?obj:{default:obj}}},{}],6:[function(require,module,exports){module.exports=function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}},{}],7:[function(require,module,exports){module.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},{}],8:[function(require,module,exports){var arrayWithHoles=require("./arrayWithHoles"),iterableToArrayLimit=require("./iterableToArrayLimit"),nonIterableRest=require("./nonIterableRest");module.exports=function(arr,i){return arrayWithHoles(arr)||iterableToArrayLimit(arr,i)||nonIterableRest()}},{"./arrayWithHoles":1,"./iterableToArrayLimit":6,"./nonIterableRest":7}],9:[function(require,module,exports){function _typeof2(obj){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _typeof(obj){return"function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?module.exports=_typeof=function(obj){return _typeof2(obj)}:module.exports=_typeof=function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}module.exports=_typeof},{}],10:[function(require,module,exports){module.exports=require("regenerator-runtime")},{"regenerator-runtime":15}],11:[function(require,module,exports){!function(){"use strict";function FastClick(layer,options){var oldOnClick;if(options=options||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=options.touchBoundary||10,this.layer=layer,this.tapDelay=options.tapDelay||200,this.tapTimeout=options.tapTimeout||700,!FastClick.notNeeded(layer)){for(var methods=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],i=0,l=methods.length;i<l;i++)this[methods[i]]=bind(this[methods[i]],this);deviceIsAndroid&&(layer.addEventListener("mouseover",this.onMouse,!0),layer.addEventListener("mousedown",this.onMouse,!0),layer.addEventListener("mouseup",this.onMouse,!0)),layer.addEventListener("click",this.onClick,!0),layer.addEventListener("touchstart",this.onTouchStart,!1),layer.addEventListener("touchmove",this.onTouchMove,!1),layer.addEventListener("touchend",this.onTouchEnd,!1),layer.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;"click"===type?rmv.call(layer,type,callback.hijacked||callback,capture):rmv.call(layer,type,callback,capture)},layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;"click"===type?adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){event.propagationStopped||callback(event)}),capture):adv.call(layer,type,callback,capture)}),"function"==typeof layer.onclick&&(oldOnClick=layer.onclick,layer.addEventListener("click",function(event){oldOnClick(event)},!1),layer.onclick=null)}function bind(method,context){return function(){return method.apply(context,arguments)}}}var deviceIsWindowsPhone=0<=navigator.userAgent.indexOf("Windows Phone"),deviceIsAndroid=0<navigator.userAgent.indexOf("Android")&&!deviceIsWindowsPhone,deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent)&&!deviceIsWindowsPhone,deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),deviceIsIOSWithBadTarget=deviceIsIOS&&/OS [6-7]_\d/.test(navigator.userAgent),deviceIsBlackBerry10=0<navigator.userAgent.indexOf("BB10");FastClick.prototype.needsClick=function(target){switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled)return!0;break;case"input":if(deviceIsIOS&&"file"===target.type||target.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(target.className)},FastClick.prototype.needsFocus=function(target){switch(target.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}},FastClick.prototype.sendClick=function(targetElement,event){var clickEvent,touch;document.activeElement&&document.activeElement!==targetElement&&document.activeElement.blur(),touch=event.changedTouches[0],(clickEvent=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(targetElement),!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),clickEvent.forwardedTouchEvent=!0,targetElement.dispatchEvent(clickEvent)},FastClick.prototype.determineEventType=function(targetElement){return deviceIsAndroid&&"select"===targetElement.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(targetElement){var length;deviceIsIOS&&targetElement.setSelectionRange&&0!==targetElement.type.indexOf("date")&&"time"!==targetElement.type&&"month"!==targetElement.type?(length=targetElement.value.length,targetElement.setSelectionRange(length,length)):targetElement.focus()},FastClick.prototype.updateScrollParent=function(targetElement){var scrollParent,parentElement;if(!(scrollParent=targetElement.fastClickScrollParent)||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement,targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}scrollParent&&(scrollParent.fastClickLastScrollTop=scrollParent.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){return eventTarget.nodeType===Node.TEXT_NODE?eventTarget.parentNode:eventTarget},FastClick.prototype.onTouchStart=function(event){var targetElement,touch,selection;if(1<event.targetTouches.length)return!0;if(targetElement=this.getTargetElementFromEventTarget(event.target),touch=event.targetTouches[0],deviceIsIOS){if((selection=window.getSelection()).rangeCount&&!selection.isCollapsed)return!0;if(!deviceIsIOS4){if(touch.identifier&&touch.identifier===this.lastTouchIdentifier)return event.preventDefault(),!1;this.lastTouchIdentifier=touch.identifier,this.updateScrollParent(targetElement)}}return this.trackingClick=!0,this.trackingClickStart=event.timeStamp,this.targetElement=targetElement,this.touchStartX=touch.pageX,this.touchStartY=touch.pageY,event.timeStamp-this.lastClickTime<this.tapDelay&&event.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(event){var touch=event.changedTouches[0],boundary=this.touchBoundary;return Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary},FastClick.prototype.onTouchMove=function(event){return this.trackingClick&&(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event))&&(this.trackingClick=!1,this.targetElement=null),!0},FastClick.prototype.findControl=function(labelElement){return void 0!==labelElement.control?labelElement.control:labelElement.htmlFor?document.getElementById(labelElement.htmlFor):labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(event){var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick)return!0;if(event.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0;if(event.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=event.timeStamp,trackingClickStart=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,deviceIsIOSWithBadTarget&&(touch=event.changedTouches[0],(targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(targetTagName=targetElement.tagName.toLowerCase())){if(forElement=this.findControl(targetElement)){if(this.focus(targetElement),deviceIsAndroid)return!1;targetElement=forElement}}else if(this.needsFocus(targetElement))return 100<event.timeStamp-trackingClickStart||deviceIsIOS&&window.top!==window&&"input"===targetTagName?this.targetElement=null:(this.focus(targetElement),this.sendClick(targetElement,event),deviceIsIOS&&"select"===targetTagName||(this.targetElement=null,event.preventDefault())),!1;return!(!deviceIsIOS||deviceIsIOS4||!(scrollParent=targetElement.fastClickScrollParent)||scrollParent.fastClickLastScrollTop===scrollParent.scrollTop)||(this.needsClick(targetElement)||(event.preventDefault(),this.sendClick(targetElement,event)),!1)},FastClick.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(event){return!this.targetElement||(!!event.forwardedTouchEvent||(!event.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(event.stopImmediatePropagation?event.stopImmediatePropagation():event.propagationStopped=!0,event.stopPropagation(),event.preventDefault(),!1))))},FastClick.prototype.onClick=function(event){var permitted;return this.trackingClick?(this.targetElement=null,!(this.trackingClick=!1)):"submit"===event.target.type&&0===event.detail||((permitted=this.onMouse(event))||(this.targetElement=null),permitted)},FastClick.prototype.destroy=function(){var layer=this.layer;deviceIsAndroid&&(layer.removeEventListener("mouseover",this.onMouse,!0),layer.removeEventListener("mousedown",this.onMouse,!0),layer.removeEventListener("mouseup",this.onMouse,!0)),layer.removeEventListener("click",this.onClick,!0),layer.removeEventListener("touchstart",this.onTouchStart,!1),layer.removeEventListener("touchmove",this.onTouchMove,!1),layer.removeEventListener("touchend",this.onTouchEnd,!1),layer.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(layer){var metaViewport,chromeVersion,blackberryVersion;if(void 0===window.ontouchstart)return!0;if(chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!deviceIsAndroid)return!0;if(metaViewport=document.querySelector("meta[name=viewport]")){if(-1!==metaViewport.content.indexOf("user-scalable=no"))return!0;if(31<chromeVersion&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(deviceIsBlackBerry10&&10<=(blackberryVersion=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]&&3<=blackberryVersion[2]&&(metaViewport=document.querySelector("meta[name=viewport]"))){if(-1!==metaViewport.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===layer.style.msTouchAction||"manipulation"===layer.style.touchAction||(!!(27<=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]&&(metaViewport=document.querySelector("meta[name=viewport]"))&&(-1!==metaViewport.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===layer.style.touchAction||"manipulation"===layer.style.touchAction))},FastClick.attach=function(layer,options){return new FastClick(layer,options)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return FastClick}):void 0!==module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick}()},{}],12:[function(require,module,exports){(function(global){var a,b;a=this,b=function(){"use strict";function c(b,c,d){var e=new XMLHttpRequest;e.open("GET",b),e.responseType="blob",e.onload=function(){a(e.response,c,d)},e.onerror=function(){console.error("could not download file")},e.send()}function d(a){var b=new XMLHttpRequest;return b.open("HEAD",a,!1),b.send(),200<=b.status&&b.status<=299}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4e4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(function(a,b){return void 0===b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\ufeff",a],{type:a.type}):a}(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(a,b,d,e){if((e=e||open("","_blank"))&&(e.document.title=e.document.body.innerText="downloading..."),"string"==typeof a)return c(a,b,d);var g="application/octet-stream"===a.type,h=/constructor/i.test(f.HTMLElement)||f.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||g&&h)&&"object"==typeof FileReader){var j=new FileReader;j.onloadend=function(){var a=j.result;a=i?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),e?e.location.href=a:location=a,e=null},j.readAsDataURL(a)}else{var k=f.URL||f.webkitURL,l=k.createObjectURL(a);e?e.location=l:location.href=l,e=null,setTimeout(function(){k.revokeObjectURL(l)},4e4)}});f.saveAs=a.saveAs=a,void 0!==module&&(module.exports=a)},"function"==typeof define&&define.amd?define([],b):void 0!==exports?b():(b(),a.FileSaver={})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(require,module,exports){(function(global){!function(f){if("object"==typeof exports&&void 0!==module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this).localforage=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){(function(global){"use strict";var scheduleDrain,draining,Mutation=global.MutationObserver||global.WebKitMutationObserver;if(Mutation){var called=0,observer=new Mutation(nextTick),element=global.document.createTextNode("");observer.observe(element,{characterData:!0}),scheduleDrain=function(){element.data=called=++called%2}}else if(global.setImmediate||void 0===global.MessageChannel)scheduleDrain="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick(),scriptEl.onreadystatechange=null,scriptEl.parentNode.removeChild(scriptEl),scriptEl=null},global.document.documentElement.appendChild(scriptEl)}:function(){setTimeout(nextTick,0)};else{var channel=new global.MessageChannel;channel.port1.onmessage=nextTick,scheduleDrain=function(){channel.port2.postMessage(0)}}var queue=[];function nextTick(){var i,oldQueue;draining=!0;for(var len=queue.length;len;){for(oldQueue=queue,queue=[],i=-1;++i<len;)oldQueue[i]();len=queue.length}draining=!1}module.exports=function(task){1!==queue.push(task)||draining||scheduleDrain()}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(_dereq_,module,exports){"use strict";var immediate=_dereq_(1);function INTERNAL(){}var handlers={},REJECTED=["REJECTED"],FULFILLED=["FULFILLED"],PENDING=["PENDING"];function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function");this.state=PENDING,this.queue=[],this.outcome=void 0,resolver!==INTERNAL&&safelyResolveThenable(this,resolver)}function QueueItem(promise,onFulfilled,onRejected){this.promise=promise,"function"==typeof onFulfilled&&(this.onFulfilled=onFulfilled,this.callFulfilled=this.otherCallFulfilled),"function"==typeof onRejected&&(this.onRejected=onRejected,this.callRejected=this.otherCallRejected)}function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}returnValue===promise?handlers.reject(promise,new TypeError("Cannot resolve promise with itself")):handlers.resolve(promise,returnValue)})}function getThen(obj){var then=obj&&obj.then;if(obj&&("object"==typeof obj||"function"==typeof obj)&&"function"==typeof then)return function(){then.apply(obj,arguments)}}function safelyResolveThenable(self,thenable){var called=!1;function onError(value){called||(called=!0,handlers.reject(self,value))}function onSuccess(value){called||(called=!0,handlers.resolve(self,value))}var result=tryCatch(function(){thenable(onSuccess,onError)});"error"===result.status&&onError(result.value)}function tryCatch(func,value){var out={};try{out.value=func(value),out.status="success"}catch(e){out.status="error",out.value=e}return out}(module.exports=Promise).prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){if("function"!=typeof onFulfilled&&this.state===FULFILLED||"function"!=typeof onRejected&&this.state===REJECTED)return this;var promise=new this.constructor(INTERNAL);this.state!==PENDING?unwrap(promise,this.state===FULFILLED?onFulfilled:onRejected,this.outcome):this.queue.push(new QueueItem(promise,onFulfilled,onRejected));return promise},QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)},QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)},QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)},QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)},handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if("error"===result.status)return handlers.reject(self,result.value);var thenable=result.value;if(thenable)safelyResolveThenable(self,thenable);else{self.state=FULFILLED,self.outcome=value;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callFulfilled(value)}return self},handlers.reject=function(self,error){self.state=REJECTED,self.outcome=error;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callRejected(error);return self},Promise.resolve=function(value){if(value instanceof this)return value;return handlers.resolve(new this(INTERNAL),value)},Promise.reject=function(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)},Promise.all=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var values=new Array(len),resolved=0,i=-1,promise=new this(INTERNAL);for(;++i<len;)allResolver(iterable[i],i);return promise;function allResolver(value,i){self.resolve(value).then(function(outValue){values[i]=outValue,++resolved!==len||called||(called=!0,handlers.resolve(promise,values))},function(error){called||(called=!0,handlers.reject(promise,error))})}},Promise.race=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var i=-1,promise=new this(INTERNAL);for(;++i<len;)value=iterable[i],self.resolve(value).then(function(response){called||(called=!0,handlers.resolve(promise,response))},function(error){called||(called=!0,handlers.reject(promise,error))});var value;return promise}},{1:1}],3:[function(_dereq_,module,exports){(function(global){"use strict";"function"!=typeof global.Promise&&(global.Promise=_dereq_(2))}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(_dereq_,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var idb=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function createBlob(parts,properties){parts=parts||[],properties=properties||{};try{return new Blob(parts,properties)}catch(e){if("TypeError"!==e.name)throw e;for(var builder=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<parts.length;i+=1)builder.append(parts[i]);return builder.getBlob(properties.type)}}"undefined"==typeof Promise&&_dereq_(3);var Promise$1=Promise;function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}function executeTwoCallbacks(promise,callback,errorCallback){"function"==typeof callback&&promise.then(callback),"function"==typeof errorCallback&&promise.catch(errorCallback)}function normalizeKey(key){return"string"!=typeof key&&(console.warn(key+" used as a key, but it is not a string."),key=String(key)),key}function getCallback(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var DETECT_BLOB_SUPPORT_STORE="local-forage-detect-blob-support",supportsBlobs=void 0,dbContexts={},toString=Object.prototype.toString,READ_WRITE="readwrite";function _checkBlobSupport(idb){return"boolean"==typeof supportsBlobs?Promise$1.resolve(supportsBlobs):function(idb){return new Promise$1(function(resolve){var txn=idb.transaction(DETECT_BLOB_SUPPORT_STORE,READ_WRITE),blob=createBlob([""]);txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,"key"),txn.onabort=function(e){e.preventDefault(),e.stopPropagation(),resolve(!1)},txn.oncomplete=function(){var matchedChrome=navigator.userAgent.match(/Chrome\/(\d+)/),matchedEdge=navigator.userAgent.match(/Edge\//);resolve(matchedEdge||!matchedChrome||43<=parseInt(matchedChrome[1],10))}}).catch(function(){return!1})}(idb).then(function(value){return supportsBlobs=value})}function _deferReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name],deferredOperation={};deferredOperation.promise=new Promise$1(function(resolve,reject){deferredOperation.resolve=resolve,deferredOperation.reject=reject}),dbContext.deferredOperations.push(deferredOperation),dbContext.dbReady?dbContext.dbReady=dbContext.dbReady.then(function(){return deferredOperation.promise}):dbContext.dbReady=deferredOperation.promise}function _advanceReadiness(dbInfo){var deferredOperation=dbContexts[dbInfo.name].deferredOperations.pop();if(deferredOperation)return deferredOperation.resolve(),deferredOperation.promise}function _rejectReadiness(dbInfo,err){var deferredOperation=dbContexts[dbInfo.name].deferredOperations.pop();if(deferredOperation)return deferredOperation.reject(err),deferredOperation.promise}function _getConnection(dbInfo,upgradeNeeded){return new Promise$1(function(resolve,reject){if(dbContexts[dbInfo.name]=dbContexts[dbInfo.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},dbInfo.db){if(!upgradeNeeded)return resolve(dbInfo.db);_deferReadiness(dbInfo),dbInfo.db.close()}var dbArgs=[dbInfo.name];upgradeNeeded&&dbArgs.push(dbInfo.version);var openreq=idb.open.apply(idb,dbArgs);upgradeNeeded&&(openreq.onupgradeneeded=function(e){var db=openreq.result;try{db.createObjectStore(dbInfo.storeName),e.oldVersion<=1&&db.createObjectStore(DETECT_BLOB_SUPPORT_STORE)}catch(ex){if("ConstraintError"!==ex.name)throw ex;console.warn('The database "'+dbInfo.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+dbInfo.storeName+'" already exists.')}}),openreq.onerror=function(e){e.preventDefault(),reject(openreq.error)},openreq.onsuccess=function(){resolve(openreq.result),_advanceReadiness(dbInfo)}})}function _getOriginalConnection(dbInfo){return _getConnection(dbInfo,!1)}function _getUpgradedConnection(dbInfo){return _getConnection(dbInfo,!0)}function _isUpgradeNeeded(dbInfo,defaultVersion){if(!dbInfo.db)return!0;var isNewStore=!dbInfo.db.objectStoreNames.contains(dbInfo.storeName),isDowngrade=dbInfo.version<dbInfo.db.version,isUpgrade=dbInfo.version>dbInfo.db.version;if(isDowngrade&&(dbInfo.version!==defaultVersion&&console.warn('The database "'+dbInfo.name+"\" can't be downgraded from version "+dbInfo.db.version+" to version "+dbInfo.version+"."),dbInfo.version=dbInfo.db.version),isUpgrade||isNewStore){if(isNewStore){var incVersion=dbInfo.db.version+1;incVersion>dbInfo.version&&(dbInfo.version=incVersion)}return!0}return!1}function _decodeBlob(encodedBlob){return createBlob([function(bin){for(var length=bin.length,buf=new ArrayBuffer(length),arr=new Uint8Array(buf),i=0;i<length;i++)arr[i]=bin.charCodeAt(i);return buf}(atob(encodedBlob.data))],{type:encodedBlob.type})}function _isEncodedBlob(value){return value&&value.__local_forage_encoded_blob}function _fullyReady(callback){var self=this,promise=self._initReady().then(function(){var dbContext=dbContexts[self._dbInfo.name];if(dbContext&&dbContext.dbReady)return dbContext.dbReady});return executeTwoCallbacks(promise,callback,callback),promise}function createTransaction(dbInfo,mode,callback,retries){void 0===retries&&(retries=1);try{var tx=dbInfo.db.transaction(dbInfo.storeName,mode);callback(null,tx)}catch(err){if(0<retries&&(!dbInfo.db||"InvalidStateError"===err.name||"NotFoundError"===err.name))return Promise$1.resolve().then(function(){if(!dbInfo.db||"NotFoundError"===err.name&&!dbInfo.db.objectStoreNames.contains(dbInfo.storeName)&&dbInfo.version<=dbInfo.db.version)return dbInfo.db&&(dbInfo.version=dbInfo.db.version+1),_getUpgradedConnection(dbInfo)}).then(function(){return function(dbInfo){_deferReadiness(dbInfo);for(var dbContext=dbContexts[dbInfo.name],forages=dbContext.forages,i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db&&(forage._dbInfo.db.close(),forage._dbInfo.db=null)}return dbInfo.db=null,_getOriginalConnection(dbInfo).then(function(db){return dbInfo.db=db,_isUpgradeNeeded(dbInfo)?_getUpgradedConnection(dbInfo):db}).then(function(db){dbInfo.db=dbContext.db=db;for(var i=0;i<forages.length;i++)forages[i]._dbInfo.db=db}).catch(function(err){throw _rejectReadiness(dbInfo,err),err})}(dbInfo).then(function(){createTransaction(dbInfo,mode,callback,retries-1)})}).catch(callback);callback(err)}}var asyncStorage={_driver:"asyncStorage",_initStorage:function(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]=options[i];var dbContext=dbContexts[dbInfo.name];dbContext||(dbContext={forages:[],db:null,dbReady:null,deferredOperations:[]},dbContexts[dbInfo.name]=dbContext),dbContext.forages.push(self),self._initReady||(self._initReady=self.ready,self.ready=_fullyReady);var initPromises=[];function ignoreErrors(){return Promise$1.resolve()}for(var j=0;j<dbContext.forages.length;j++){var forage=dbContext.forages[j];forage!==self&&initPromises.push(forage._initReady().catch(ignoreErrors))}var forages=dbContext.forages.slice(0);return Promise$1.all(initPromises).then(function(){return dbInfo.db=dbContext.db,_getOriginalConnection(dbInfo)}).then(function(db){return dbInfo.db=db,_isUpgradeNeeded(dbInfo,self._defaultConfig.version)?_getUpgradedConnection(dbInfo):db}).then(function(db){dbInfo.db=dbContext.db=db,self._dbInfo=dbInfo;for(var k=0;k<forages.length;k++){var forage=forages[k];forage!==self&&(forage._dbInfo.db=dbInfo.db,forage._dbInfo.version=dbInfo.version)}})},_support:function(){try{if(!idb)return!1;var isSafari="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),hasFetch="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!isSafari||hasFetch)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(iterator,callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,"readonly",function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).openCursor(),iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var value=cursor.value;_isEncodedBlob(value)&&(value=_decodeBlob(value));var result=iterator(value,cursor.key,iterationNumber++);void 0!==result?resolve(result):cursor.continue()}else resolve()},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},getItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,"readonly",function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).get(key);req.onsuccess=function(){var value=req.result;void 0===value&&(value=null),_isEncodedBlob(value)&&(value=_decodeBlob(value)),resolve(value)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},setItem:function(key,value,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){var dbInfo;self.ready().then(function(){return dbInfo=self._dbInfo,"[object Blob]"===toString.call(value)?_checkBlobSupport(dbInfo.db).then(function(blobSupport){return blobSupport?value:(blob=value,new Promise$1(function(resolve,reject){var reader=new FileReader;reader.onerror=reject,reader.onloadend=function(e){var base64=btoa(e.target.result||"");resolve({__local_forage_encoded_blob:!0,data:base64,type:blob.type})},reader.readAsBinaryString(blob)}));var blob}):value}).then(function(value){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self._dbInfo.storeName);null===value&&(value=void 0);var req=store.put(value,key);transaction.oncomplete=function(){void 0===value&&(value=null),resolve(value)},transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},removeItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).delete(key);transaction.oncomplete=function(){resolve()},transaction.onerror=function(){reject(req.error)},transaction.onabort=function(){var err=req.error?req.error:req.transaction.error;reject(err)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},clear:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).clear();transaction.oncomplete=function(){resolve()},transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},length:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,"readonly",function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).count();req.onsuccess=function(){resolve(req.result)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},key:function(n,callback){var self=this,promise=new Promise$1(function(resolve,reject){n<0?resolve(null):self.ready().then(function(){createTransaction(self._dbInfo,"readonly",function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self._dbInfo.storeName),advanced=!1,req=store.openCursor();req.onsuccess=function(){var cursor=req.result;cursor?0===n?resolve(cursor.key):advanced?resolve(cursor.key):(advanced=!0,cursor.advance(n)):resolve(null)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},keys:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){createTransaction(self._dbInfo,"readonly",function(err,transaction){if(err)return reject(err);try{var req=transaction.objectStore(self._dbInfo.storeName).openCursor(),keys=[];req.onsuccess=function(){var cursor=req.result;cursor?(keys.push(cursor.key),cursor.continue()):resolve(keys)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise},dropInstance:function(options,callback){callback=getCallback.apply(this,arguments);var promise,currentConfig=this.config();if((options="function"!=typeof options&&options||{}).name||(options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName),options.name){var dbPromise=options.name===currentConfig.name&&this._dbInfo.db?Promise$1.resolve(this._dbInfo.db):_getOriginalConnection(options).then(function(db){var dbContext=dbContexts[options.name],forages=dbContext.forages;dbContext.db=db;for(var i=0;i<forages.length;i++)forages[i]._dbInfo.db=db;return db});promise=options.storeName?dbPromise.then(function(db){if(db.objectStoreNames.contains(options.storeName)){var newVersion=db.version+1;_deferReadiness(options);var dbContext=dbContexts[options.name],forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db=null,forage._dbInfo.version=newVersion}return new Promise$1(function(resolve,reject){var req=idb.open(options.name,newVersion);req.onerror=function(err){req.result.close(),reject(err)},req.onupgradeneeded=function(){req.result.deleteObjectStore(options.storeName)},req.onsuccess=function(){var db=req.result;db.close(),resolve(db)}}).then(function(db){dbContext.db=db;for(var j=0;j<forages.length;j++){var _forage2=forages[j];_forage2._dbInfo.db=db,_advanceReadiness(_forage2._dbInfo)}}).catch(function(err){throw(_rejectReadiness(options,err)||Promise$1.resolve()).catch(function(){}),err})}}):dbPromise.then(function(db){_deferReadiness(options);var dbContext=dbContexts[options.name],forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++)forages[i]._dbInfo.db=null;return new Promise$1(function(resolve,reject){var req=idb.deleteDatabase(options.name);req.onerror=req.onblocked=function(err){var db=req.result;db&&db.close(),reject(err)},req.onsuccess=function(){var db=req.result;db&&db.close(),resolve(db)}}).then(function(db){dbContext.db=db;for(var i=0;i<forages.length;i++)_advanceReadiness(forages[i]._dbInfo)}).catch(function(err){throw(_rejectReadiness(options,err)||Promise$1.resolve()).catch(function(){}),err})})}else promise=Promise$1.reject("Invalid arguments");return executeCallback(promise,callback),promise}};var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BLOB_TYPE_PREFIX_REGEX=/^~~local_forage_type~([^~]+)~/,SERIALIZED_MARKER_LENGTH="__lfsc__:".length,TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+"arbf".length,toString$1=Object.prototype.toString;function stringToBuffer(serializedString){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*serializedString.length,len=serializedString.length,p=0;"="===serializedString[serializedString.length-1]&&(bufferLength--,"="===serializedString[serializedString.length-2]&&bufferLength--);var buffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(buffer);for(i=0;i<len;i+=4)encoded1=BASE_CHARS.indexOf(serializedString[i]),encoded2=BASE_CHARS.indexOf(serializedString[i+1]),encoded3=BASE_CHARS.indexOf(serializedString[i+2]),encoded4=BASE_CHARS.indexOf(serializedString[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return buffer}function bufferToString(buffer){var i,bytes=new Uint8Array(buffer),base64String="";for(i=0;i<bytes.length;i+=3)base64String+=BASE_CHARS[bytes[i]>>2],base64String+=BASE_CHARS[(3&bytes[i])<<4|bytes[i+1]>>4],base64String+=BASE_CHARS[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64String+=BASE_CHARS[63&bytes[i+2]];return bytes.length%3==2?base64String=base64String.substring(0,base64String.length-1)+"=":bytes.length%3==1&&(base64String=base64String.substring(0,base64String.length-2)+"=="),base64String}var localforageSerializer={serialize:function(value,callback){var valueType="";if(value&&(valueType=toString$1.call(value)),value&&("[object ArrayBuffer]"===valueType||value.buffer&&"[object ArrayBuffer]"===toString$1.call(value.buffer))){var buffer,marker="__lfsc__:";value instanceof ArrayBuffer?(buffer=value,marker+="arbf"):(buffer=value.buffer,"[object Int8Array]"===valueType?marker+="si08":"[object Uint8Array]"===valueType?marker+="ui08":"[object Uint8ClampedArray]"===valueType?marker+="uic8":"[object Int16Array]"===valueType?marker+="si16":"[object Uint16Array]"===valueType?marker+="ur16":"[object Int32Array]"===valueType?marker+="si32":"[object Uint32Array]"===valueType?marker+="ui32":"[object Float32Array]"===valueType?marker+="fl32":"[object Float64Array]"===valueType?marker+="fl64":callback(new Error("Failed to get type for BinaryArray"))),callback(marker+bufferToString(buffer))}else if("[object Blob]"===valueType){var fileReader=new FileReader;fileReader.onload=function(){var str="~~local_forage_type~"+value.type+"~"+bufferToString(this.result);callback("__lfsc__:blob"+str)},fileReader.readAsArrayBuffer(value)}else try{callback(JSON.stringify(value))}catch(e){console.error("Couldn't convert value into a JSON string: ",value),callback(null,e)}},deserialize:function(value){if("__lfsc__:"!==value.substring(0,SERIALIZED_MARKER_LENGTH))return JSON.parse(value);var blobType,serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH),type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH);if("blob"===type&&BLOB_TYPE_PREFIX_REGEX.test(serializedString)){var matcher=serializedString.match(BLOB_TYPE_PREFIX_REGEX);blobType=matcher[1],serializedString=serializedString.substring(matcher[0].length)}var buffer=stringToBuffer(serializedString);switch(type){case"arbf":return buffer;case"blob":return createBlob([buffer],{type:blobType});case"si08":return new Int8Array(buffer);case"ui08":return new Uint8Array(buffer);case"uic8":return new Uint8ClampedArray(buffer);case"si16":return new Int16Array(buffer);case"ur16":return new Uint16Array(buffer);case"si32":return new Int32Array(buffer);case"ui32":return new Uint32Array(buffer);case"fl32":return new Float32Array(buffer);case"fl64":return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}},stringToBuffer:stringToBuffer,bufferToString:bufferToString};function createDbTable(t,dbInfo,callback,errorCallback){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],callback,errorCallback)}function tryExecuteSql(t,dbInfo,sqlStatement,args,callback,errorCallback){t.executeSql(sqlStatement,args,callback,function(t,error){error.code===error.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[dbInfo.storeName],function(t,results){results.rows.length?errorCallback(t,error):createDbTable(t,dbInfo,function(){t.executeSql(sqlStatement,args,callback,errorCallback)},errorCallback)},errorCallback):errorCallback(t,error)},errorCallback)}var webSQLStorage={_driver:"webSQLStorage",_initStorage:function(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]="string"!=typeof options[i]?options[i].toString():options[i];var dbInfoPromise=new Promise$1(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size)}catch(e){return reject(e)}dbInfo.db.transaction(function(t){createDbTable(t,dbInfo,function(){self._dbInfo=dbInfo,resolve()},function(t,error){reject(error)})},reject)});return dbInfo.serializer=localforageSerializer,dbInfoPromise},_support:"function"==typeof openDatabase,iterate:function(iterator,callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT * FROM "+dbInfo.storeName,[],function(t,results){for(var rows=results.rows,length=rows.length,i=0;i<length;i++){var item=rows.item(i),result=item.value;if(result&&(result=dbInfo.serializer.deserialize(result)),void 0!==(result=iterator(result,item.key,i+1)))return void resolve(result)}resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},getItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;result&&(result=dbInfo.serializer.deserialize(result)),resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},setItem:function(key,value,callback){return function _setItem(key,value,callback,retriesLeft){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){void 0===value&&(value=null);var originalValue=value,dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){error?reject(error):dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key,value],function(){resolve(originalValue)},function(t,error){reject(error)})},function(sqlError){if(sqlError.code===sqlError.QUOTA_ERR){if(0<retriesLeft)return void resolve(_setItem.apply(self,[key,originalValue,callback,retriesLeft-1]));reject(sqlError)}})})}).catch(reject)});return executeCallback(promise,callback),promise}.apply(this,[key,value,callback,1])},removeItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},clear:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},length:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},key:function(n,callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},keys:function(callback){var self=this,promise=new Promise$1(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT key FROM "+dbInfo.storeName,[],function(t,results){for(var keys=[],i=0;i<results.rows.length;i++)keys.push(results.rows.item(i).key);resolve(keys)},function(t,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise},dropInstance:function(options,callback){callback=getCallback.apply(this,arguments);var currentConfig=this.config();(options="function"!=typeof options&&options||{}).name||(options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName);var promise,self=this;return executeCallback(promise=options.name?new Promise$1(function(resolve){var db;db=options.name===currentConfig.name?self._dbInfo.db:openDatabase(options.name,"","",0),options.storeName?resolve({db:db,storeNames:[options.storeName]}):resolve(function(db){return new Promise$1(function(resolve,reject){db.transaction(function(t){t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,results){for(var storeNames=[],i=0;i<results.rows.length;i++)storeNames.push(results.rows.item(i).name);resolve({db:db,storeNames:storeNames})},function(t,error){reject(error)})},function(sqlError){reject(sqlError)})})}(db))}).then(function(operationInfo){return new Promise$1(function(resolve,reject){operationInfo.db.transaction(function(t){function dropTable(storeName){return new Promise$1(function(resolve,reject){t.executeSql("DROP TABLE IF EXISTS "+storeName,[],function(){resolve()},function(t,error){reject(error)})})}for(var operations=[],i=0,len=operationInfo.storeNames.length;i<len;i++)operations.push(dropTable(operationInfo.storeNames[i]));Promise$1.all(operations).then(function(){resolve()}).catch(function(e){reject(e)})},function(sqlError){reject(sqlError)})})}):Promise$1.reject("Invalid arguments"),callback),promise}};function _getKeyPrefix(options,defaultConfig){var keyPrefix=options.name+"/";return options.storeName!==defaultConfig.storeName&&(keyPrefix+=options.storeName+"/"),keyPrefix}function _isLocalStorageUsable(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||0<localStorage.length}var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:function(options){var dbInfo={};if(options)for(var i in options)dbInfo[i]=options[i];return dbInfo.keyPrefix=_getKeyPrefix(options,this._defaultConfig),_isLocalStorageUsable()?((this._dbInfo=dbInfo).serializer=localforageSerializer,Promise$1.resolve()):Promise$1.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(iterator,callback){var self=this,promise=self.ready().then(function(){for(var dbInfo=self._dbInfo,keyPrefix=dbInfo.keyPrefix,keyPrefixLength=keyPrefix.length,length=localStorage.length,iterationNumber=1,i=0;i<length;i++){var key=localStorage.key(i);if(0===key.indexOf(keyPrefix)){var value=localStorage.getItem(key);if(value&&(value=dbInfo.serializer.deserialize(value)),void 0!==(value=iterator(value,key.substring(keyPrefixLength),iterationNumber++)))return value}}});return executeCallback(promise,callback),promise},getItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){var dbInfo=self._dbInfo,result=localStorage.getItem(dbInfo.keyPrefix+key);return result&&(result=dbInfo.serializer.deserialize(result)),result});return executeCallback(promise,callback),promise},setItem:function(key,value,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;return new Promise$1(function(resolve,reject){var dbInfo=self._dbInfo;dbInfo.serializer.serialize(value,function(value,error){if(error)reject(error);else try{localStorage.setItem(dbInfo.keyPrefix+key,value),resolve(originalValue)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||reject(e),reject(e)}})})});return executeCallback(promise,callback),promise},removeItem:function(key,callback){var self=this;key=normalizeKey(key);var promise=self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key)});return executeCallback(promise,callback),promise},clear:function(callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,i=localStorage.length-1;0<=i;i--){var key=localStorage.key(i);0===key.indexOf(keyPrefix)&&localStorage.removeItem(key)}});return executeCallback(promise,callback),promise},length:function(callback){var promise=this.keys().then(function(keys){return keys.length});return executeCallback(promise,callback),promise},key:function(n,callback){var self=this,promise=self.ready().then(function(){var result,dbInfo=self._dbInfo;try{result=localStorage.key(n)}catch(error){result=null}return result&&(result=result.substring(dbInfo.keyPrefix.length)),result});return executeCallback(promise,callback),promise},keys:function(callback){var self=this,promise=self.ready().then(function(){for(var dbInfo=self._dbInfo,length=localStorage.length,keys=[],i=0;i<length;i++){var itemKey=localStorage.key(i);0===itemKey.indexOf(dbInfo.keyPrefix)&&keys.push(itemKey.substring(dbInfo.keyPrefix.length))}return keys});return executeCallback(promise,callback),promise},dropInstance:function(options,callback){if(callback=getCallback.apply(this,arguments),!(options="function"!=typeof options&&options||{}).name){var currentConfig=this.config();options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName}var promise,self=this;return executeCallback(promise=options.name?new Promise$1(function(resolve){options.storeName?resolve(_getKeyPrefix(options,self._defaultConfig)):resolve(options.name+"/")}).then(function(keyPrefix){for(var i=localStorage.length-1;0<=i;i--){var key=localStorage.key(i);0===key.indexOf(keyPrefix)&&localStorage.removeItem(key)}}):Promise$1.reject("Invalid arguments"),callback),promise}},includes=function(array,searchElement){for(var x,y,len=array.length,i=0;i<len;){if((x=array[i])===(y=searchElement)||"number"==typeof x&&"number"==typeof y&&isNaN(x)&&isNaN(y))return!0;i++}return!1},isArray=Array.isArray||function(arg){return"[object Array]"===Object.prototype.toString.call(arg)},DefinedDrivers={},DriverSupport={},DefaultDrivers={INDEXEDDB:asyncStorage,WEBSQL:webSQLStorage,LOCALSTORAGE:localStorageWrapper},DefaultDriverOrder=[DefaultDrivers.INDEXEDDB._driver,DefaultDrivers.WEBSQL._driver,DefaultDrivers.LOCALSTORAGE._driver],OptionalDriverMethods=["dropInstance"],LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(OptionalDriverMethods),DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg)for(var _key in arg)arg.hasOwnProperty(_key)&&(isArray(arg[_key])?arguments[0][_key]=arg[_key].slice():arguments[0][_key]=arg[_key])}return arguments[0]}var localforage_js=new(function(){function LocalForage(options){for(var driverTypeKey in function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LocalForage),DefaultDrivers)if(DefaultDrivers.hasOwnProperty(driverTypeKey)){var driver=DefaultDrivers[driverTypeKey],driverName=driver._driver;this[driverTypeKey]=driverName,DefinedDrivers[driverName]||this.defineDriver(driver)}this._defaultConfig=extend({},DefaultConfig),this._config=extend({},this._defaultConfig,options),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return LocalForage.prototype.config=function(options){if("object"!==(void 0===options?"undefined":_typeof(options)))return"string"==typeof options?this._config[options]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in options){if("storeName"===i&&(options[i]=options[i].replace(/\W/g,"_")),"version"===i&&"number"!=typeof options[i])return new Error("Database version must be a number.");this._config[i]=options[i]}return!("driver"in options&&options.driver)||this.setDriver(this._config.driver)},LocalForage.prototype.defineDriver=function(driverObject,callback,errorCallback){var promise=new Promise$1(function(resolve,reject){try{var driverName=driverObject._driver,complianceError=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!driverObject._driver)return void reject(complianceError);for(var driverMethods=LibraryMethods.concat("_initStorage"),i=0,len=driverMethods.length;i<len;i++){var driverMethodName=driverMethods[i];if((!includes(OptionalDriverMethods,driverMethodName)||driverObject[driverMethodName])&&"function"!=typeof driverObject[driverMethodName])return void reject(complianceError)}!function(){for(var methodNotImplementedFactory=function(methodName){return function(){var error=new Error("Method "+methodName+" is not implemented by the current driver"),promise=Promise$1.reject(error);return executeCallback(promise,arguments[arguments.length-1]),promise}},_i=0,_len=OptionalDriverMethods.length;_i<_len;_i++){var optionalDriverMethod=OptionalDriverMethods[_i];driverObject[optionalDriverMethod]||(driverObject[optionalDriverMethod]=methodNotImplementedFactory(optionalDriverMethod))}}();var setDriverSupport=function(support){DefinedDrivers[driverName]&&console.info("Redefining LocalForage driver: "+driverName),DefinedDrivers[driverName]=driverObject,DriverSupport[driverName]=support,resolve()};"_support"in driverObject?driverObject._support&&"function"==typeof driverObject._support?driverObject._support().then(setDriverSupport,reject):setDriverSupport(!!driverObject._support):setDriverSupport(!0)}catch(e){reject(e)}});return executeTwoCallbacks(promise,callback,errorCallback),promise},LocalForage.prototype.driver=function(){return this._driver||null},LocalForage.prototype.getDriver=function(driverName,callback,errorCallback){var getDriverPromise=DefinedDrivers[driverName]?Promise$1.resolve(DefinedDrivers[driverName]):Promise$1.reject(new Error("Driver not found."));return executeTwoCallbacks(getDriverPromise,callback,errorCallback),getDriverPromise},LocalForage.prototype.getSerializer=function(callback){var serializerPromise=Promise$1.resolve(localforageSerializer);return executeTwoCallbacks(serializerPromise,callback),serializerPromise},LocalForage.prototype.ready=function(callback){var self=this,promise=self._driverSet.then(function(){return null===self._ready&&(self._ready=self._initDriver()),self._ready});return executeTwoCallbacks(promise,callback,callback),promise},LocalForage.prototype.setDriver=function(drivers,callback,errorCallback){var self=this;isArray(drivers)||(drivers=[drivers]);var supportedDrivers=this._getSupportedDrivers(drivers);function setDriverToConfig(){self._config.driver=self.driver()}function extendSelfWithDriver(driver){return self._extend(driver),setDriverToConfig(),self._ready=self._initStorage(self._config),self._ready}var oldDriverSetDone=null!==this._driverSet?this._driverSet.catch(function(){return Promise$1.resolve()}):Promise$1.resolve();return this._driverSet=oldDriverSetDone.then(function(){var driverName=supportedDrivers[0];return self._dbInfo=null,self._ready=null,self.getDriver(driverName).then(function(driver){self._driver=driver._driver,setDriverToConfig(),self._wrapLibraryMethodsWithReady(),self._initDriver=function(supportedDrivers){return function(){var currentDriverIndex=0;return function driverPromiseLoop(){for(;currentDriverIndex<supportedDrivers.length;){var driverName=supportedDrivers[currentDriverIndex];return currentDriverIndex++,self._dbInfo=null,self._ready=null,self.getDriver(driverName).then(extendSelfWithDriver).catch(driverPromiseLoop)}setDriverToConfig();var error=new Error("No available storage method found.");return self._driverSet=Promise$1.reject(error),self._driverSet}()}}(supportedDrivers)})}).catch(function(){setDriverToConfig();var error=new Error("No available storage method found.");return self._driverSet=Promise$1.reject(error),self._driverSet}),executeTwoCallbacks(this._driverSet,callback,errorCallback),this._driverSet},LocalForage.prototype.supports=function(driverName){return!!DriverSupport[driverName]},LocalForage.prototype._extend=function(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)},LocalForage.prototype._getSupportedDrivers=function(drivers){for(var supportedDrivers=[],i=0,len=drivers.length;i<len;i++){var driverName=drivers[i];this.supports(driverName)&&supportedDrivers.push(driverName)}return supportedDrivers},LocalForage.prototype._wrapLibraryMethodsWithReady=function(){for(var i=0,len=LibraryMethods.length;i<len;i++)callWhenReady(this,LibraryMethods[i])},LocalForage.prototype.createInstance=function(options){return new LocalForage(options)},LocalForage}());module.exports=localforage_js},{3:3}]},{},[4])(4)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(require,module,exports){!function(window,document,undefined){if(window){for(var _REVERSE_MAP,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},i=1;i<20;++i)_MAP[111+i]="f"+i;for(i=0;i<=9;++i)_MAP[i+96]=i.toString();Mousetrap.prototype.bind=function(keys,callback,action){return keys=keys instanceof Array?keys:[keys],this._bindMultiple.call(this,keys,callback,action),this},Mousetrap.prototype.unbind=function(keys,action){return this.bind.call(this,keys,function(){},action)},Mousetrap.prototype.trigger=function(keys,action){return this._directMap[keys+":"+action]&&this._directMap[keys+":"+action]({},keys),this},Mousetrap.prototype.reset=function(){return this._callbacks={},this._directMap={},this},Mousetrap.prototype.stopCallback=function(e,element){if(-1<(" "+element.className+" ").indexOf(" mousetrap "))return!1;if(function _belongsTo(element,ancestor){return null!==element&&element!==document&&(element===ancestor||_belongsTo(element.parentNode,ancestor))}(element,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var initialEventTarget=e.composedPath()[0];initialEventTarget!==e.target&&(element=initialEventTarget)}return"INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.isContentEditable},Mousetrap.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},Mousetrap.addKeycodes=function(object){for(var key in object)object.hasOwnProperty(key)&&(_MAP[key]=object[key]);_REVERSE_MAP=null},Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap)"_"!==method.charAt(0)&&(Mousetrap[method]=function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments)}}(method))},Mousetrap.init(),window.Mousetrap=Mousetrap,void 0!==module&&module.exports&&(module.exports=Mousetrap),"function"==typeof define&&define.amd&&define(function(){return Mousetrap})}function _addEvent(object,type,callback){object.addEventListener?object.addEventListener(type,callback,!1):object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if("keypress"!=e.type)return _MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase();var character=String.fromCharCode(e.which);return e.shiftKey||(character=character.toLowerCase()),character}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _pickBestAction(key,modifiers,action){return action||(action=function(){if(!_REVERSE_MAP)for(var key in _REVERSE_MAP={},_MAP)95<key&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key);return _REVERSE_MAP}()[key]?"keydown":"keypress"),"keypress"==action&&modifiers.length&&(action="keydown"),action}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];for(keys=function(combination){return"+"===combination?["+"]:(combination=combination.replace(/\+{2}/g,"+plus")).split("+")}(combination),i=0;i<keys.length;++i)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&"keypress"!=action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push("shift")),_isModifier(key)&&modifiers.push(key);return{key:key,modifiers:modifiers,action:action=_pickBestAction(key,modifiers,action)}}function Mousetrap(targetElement){var self=this;if(targetElement=targetElement||document,!(self instanceof Mousetrap))return new Mousetrap(targetElement);self.target=targetElement,self._callbacks={},self._directMap={};var _resetTimer,_sequenceLevels={},_ignoreNextKeyup=!1,_ignoreNextKeypress=!1,_nextExpectedAction=!1;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var key,activeSequences=!1;for(key in _sequenceLevels)doNotReset[key]?activeSequences=!0:_sequenceLevels[key]=0;activeSequences||(_nextExpectedAction=!1)}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,modifiers1,modifiers2,matches=[],action=e.type;if(!self._callbacks[character])return[];for("keyup"==action&&_isModifier(character)&&(modifiers=[character]),i=0;i<self._callbacks[character].length;++i)if(callback=self._callbacks[character][i],(sequenceName||!callback.seq||_sequenceLevels[callback.seq]==callback.level)&&action==callback.action&&("keypress"==action&&!e.metaKey&&!e.ctrlKey||(modifiers1=modifiers,modifiers2=callback.modifiers,modifiers1.sort().join(",")===modifiers2.sort().join(",")))){var deleteCombo=!sequenceName&&callback.combo==combination,deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;(deleteCombo||deleteSequence)&&self._callbacks[character].splice(i,1),matches.push(callback)}return matches}function _fireCallback(callback,e,combo,sequence){self.stopCallback(e,e.target||e.srcElement,combo,sequence)||!1===callback(e,combo)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(e),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(e))}function _handleKeyEvent(e){"number"!=typeof e.which&&(e.which=e.keyCode);var character=_characterFromEvent(e);character&&("keyup"!=e.type||_ignoreNextKeyup!==character?self.handleKey(character,function(e){var modifiers=[];return e.shiftKey&&modifiers.push("shift"),e.altKey&&modifiers.push("alt"),e.ctrlKey&&modifiers.push("ctrl"),e.metaKey&&modifiers.push("meta"),modifiers}(e),e):_ignoreNextKeyup=!1)}function _bindSequence(combo,keys,callback,action){function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction,++_sequenceLevels[combo],clearTimeout(_resetTimer),_resetTimer=setTimeout(_resetSequences,1e3)}}function _callbackAndReset(e){_fireCallback(callback,e,combo),"keyup"!==action&&(_ignoreNextKeyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)}for(var i=_sequenceLevels[combo]=0;i<keys.length;++i){var wrappedCallback=i+1===keys.length?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+":"+action]=callback;var info,sequence=(combination=combination.replace(/\s+/g," ")).split(" ");1<sequence.length?_bindSequence(combination,sequence,callback,action):(info=_getKeyInfo(combination,action),self._callbacks[info.key]=self._callbacks[info.key]||[],_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level),self._callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination}))}self._handleKey=function(character,modifiers,e){var i,callbacks=_getMatches(character,modifiers,e),doNotReset={},maxLevel=0,processedSequenceCallback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq&&(maxLevel=Math.max(maxLevel,callbacks[i].level));for(i=0;i<callbacks.length;++i)if(callbacks[i].seq){if(callbacks[i].level!=maxLevel)continue;processedSequenceCallback=!0,doNotReset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq)}else processedSequenceCallback||_fireCallback(callbacks[i].callback,e,callbacks[i].combo);var ignoreThisKeypress="keypress"==e.type&&_ignoreNextKeypress;e.type!=_nextExpectedAction||_isModifier(character)||ignoreThisKeypress||_resetSequences(doNotReset),_ignoreNextKeypress=processedSequenceCallback&&"keydown"==e.type},self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)},_addEvent(targetElement,"keypress",_handleKeyEvent),_addEvent(targetElement,"keydown",_handleKeyEvent),_addEvent(targetElement,"keyup",_handleKeyEvent)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},{}],15:[function(require,module,exports){var runtime=function(exports){"use strict";var undefined,Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?GenStateCompleted:GenStateSuspendedYield,record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state=GenStateCompleted,context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}function AsyncIterator(generator){var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){!function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):Promise.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}reject(record.arg)}(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}return GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction",exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,toStringTagSymbol in genFun||(genFun[toStringTagSymbol]="GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),Gp[toStringTagSymbol]="Generator",Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}("object"==typeof module?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}},{}],16:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),Mousetrap=require("mousetrap"),Coders=require("./coders"),defaultConfig=require("./config-default"),ContentBrowser=require("./content-browser.js"),Render=require("./render"),Export=require("./export"),Files=require("./files"),FontControl=require("./font"),UI=require("./ui"),mkState=require("./state"),LineNumbers=require("./line-numbers"),MobileUI=require("./mobile-ui"),Parser=require("./parser"),Screen=require("./screen"),SearchControl=require("./search"),SelectionControl=require("./selection"),URIHashControl=require("./uri-hash"),Scroll=require("./scroll");module.exports=function(){function App(){(0,_classCallCheck2.default)(this,App);var app=this;app.coders=Coders,app.config=this.loadConfig(),mkState(app),app.contentBrowser=new ContentBrowser(app),app.render=new Render(app),app.export=new Export(app),app.files=new Files(app),app.FontControl=new FontControl(app),app.ui=new UI(app),app.lineNumbers=new LineNumbers(app),app.mobileUI=new MobileUI(app),app.parser=new Parser(app),app.screen=new Screen(app),app.search=new SearchControl(app),app.selection=new SelectionControl(app),app.URIHashControl=new URIHashControl(app),app.scroll=new Scroll(app)}var _mobileInit,_postInit,_init;return(0,_createClass2.default)(App,[{key:"log",value:function(){console.log.apply(console,arguments)}},{key:"alert",value:function(_alert){function alert(){return _alert.apply(this,arguments)}return alert.toString=function(){return _alert.toString()},alert}(function(){var _console;"function"==typeof alert?alert.apply(void 0,arguments):(_console=console).log.apply(_console,["alert: "].concat(Array.prototype.slice.call(arguments)))})},{key:"loadConfig",value:function(){return"object"===(0,_typeof2.default)(window.userConfig)?Object.assign(defaultConfig,window.userConfig):defaultConfig}},{key:"initMousetrap",value:function(){var _this=this,screen=this.screen,contentBrowser=this.contentBrowser,ui=(this.state,this.ui),lineNumbers=this.lineNumbers,config=this.config,selection=this.selection,render=this.render,search=this.search,scroll=this.scroll,moveY=function(value){return function(){contentBrowser.active?contentBrowser.navigate(value):scroll.moveY(value)}},moveX=function(value){return function(){contentBrowser.active||scroll.moveX(value)}},pagedown=function(){contentBrowser.active||scroll.moveY(screen.h-1)},pageup=function(){contentBrowser.active||scroll.moveY(1-screen.h)},bindings={k:moveY(-1),"":moveY(-1),j:moveY(1),"":moveY(1),l:moveX(1),"":moveX(1),h:moveX(-1),"":moveX(-1),f:pagedown,"":pagedown,b:pageup,"":pageup,"alt+g":function(){return ui.showGotoLinePrompt()},v:function(){return lineNumbers.toggle()},"":function(){return lineNumbers.toggle()},esc:function(){selection.clear(),contentBrowser.hide()},"alt+f3":function(){return search.activateSearchField()},"":function(){return search.activateSearchField()},s:function(){return search.activateSearchField()},n:function(){return ui.duplicateWindow()},"":function(){return ui.duplicateWindow()},"":function(){return document.getElementById("file-select").click()},o:function(){return document.getElementById("file-select").click()},d:function(){return _this.export.toPNG()},"":function(){return _this.export.toPNG()},"":function(){return contentBrowser.toggle()},c:function(){return contentBrowser.toggle()},up:moveY(-1),down:moveY(1),left:moveX(-1),right:moveX(1),"ctrl+up":moveY(-config.ctrl_scroll_k),"ctrl+down":moveY(config.ctrl_scroll_k),"ctrl+left":moveX(-1*config.ctrl_scroll_k),"ctrl+right":moveX(1*config.ctrl_scroll_k),end:function(){contentBrowser.active?contentBrowser.navigate("bottom"):scroll.toEnd()},home:function(){contentBrowser.active?contentBrowser.navigate("top"):scroll.toBeginning()},pagedown:pagedown,pageup:pageup,enter:function(){if(contentBrowser.active){var el=document.querySelector(".content-list-active");el&&el.click()}}};Object.entries(bindings).forEach(function(_ref){var _ref2=(0,_slicedToArray2.default)(_ref,2),key=_ref2[0],func=_ref2[1];Mousetrap.bind(key,func)});var searchField=document.getElementById("search-field");Mousetrap(searchField).bind("esc",function(){search.close(),render.update()}),Mousetrap(searchField).bind("enter",function(){return search.searchNext()}),Mousetrap(searchField).bind("shift+enter",function(){return search.searchPrevious()}),Mousetrap(searchField).bind("backspace",function(){""==document.getElementById("search-field").value&&(search.deactivateSearchField(),render.update())})}},{key:"init",value:(_init=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var screen,files,render,config,FontControl,URIHashControl,isLocal,parsedHash;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return screen=this.screen,this.state,files=this.files,render=this.render,config=this.config,FontControl=this.FontControl,URIHashControl=this.URIHashControl,this.initMousetrap(),screen.update(),this.eventsInit(),this.canvasInit(),isLocal="file:"===document.location.protocol,_context.next=8,Promise.all(config.fonts.map(function(fontFile,ix){return FontControl.loadFont(fontFile,ix)}));case 8:if(this.log("fonts loaded!"),render.makeImageData(),this.state.is_mobile)return _context.next=13,this.mobileInit();_context.next=14;break;case 13:this.mobileEventsInit();case 14:if(null!==(parsedHash=URIHashControl.parseHash(document.location.hash)))return _context.prev=16,_context.next=19,URIHashControl.load(parsedHash);_context.next=27;break;case 19:return _context.next=21,this.postInit();case 21:return _context.abrupt("return",_context.sent);case 24:_context.prev=24,_context.t0=_context.catch(16),this.alert("Local file not found!");case 27:if(config.load_greeting_file_from_source&&!isLocal)return _context.prev=28,_context.next=31,files.loadRemote(config.greeting_file,"");_context.next=38;break;case 31:_context.next=36;break;case 33:_context.prev=33,_context.t1=_context.catch(28),this.alert("Greeting file not found!");case 36:_context.next=41;break;case 38:if(void 0===window.preloadedFile)throw new Error("No preloaded file found!");_context.next=40;break;case 40:files.loadFromSource(preloadedFile);case 41:return _context.next=43,this.postInit();case 43:case"end":return _context.stop()}},_callee,this,[[16,24],[28,33]])})),function(){return _init.apply(this,arguments)})},{key:"postInit",value:(_postInit=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return this.screen.update(),_context2.next=3,this.ui.updateFileList();case 3:this.render.makeImageData(),this.render.update(),document.getElementById("preloader").style.display="none";case 6:case"end":return _context2.stop()}},_callee2,this)})),function(){return _postInit.apply(this,arguments)})},{key:"eventsInit",value:function(){var _this2=this,search=this.search,config=this.config,state=this.state,URIHashControl=this.URIHashControl,render=this.render,coders=this.coders,files=this.files,ui=this.ui,contentBrowser=this.contentBrowser,lineNumbers=this.lineNumbers;document.getElementById("canvas");window.addEventListener("resize",function(){_this2.screen.update(),_this2.render.update(),_this2.scroll.update()}),window.addEventListener("hashchange",function(){return URIHashControl.process(document.location.hash)}),document.getElementById("search-field").addEventListener("keyup",function(){return search.performSearch()}),document.getElementById("search-close").addEventListener("click",function(){search.clearSearchField(),search.deactivateSearchField(),render.update()}),document.getElementById("file-list").addEventListener("change",function(evt){evt.target.blur()}),document.getElementById("file-select").addEventListener("change",function(evt){var fileList=evt.target.files,lastname=fileList[fileList.length-1].name;config.save_to_ls||(fileList=[fileList[fileList.length-1]]),Array.prototype.forEach.call(fileList,function(file){var reader=new FileReader;reader.onload=function(){var _ref3=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(event){var fileContent;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(config.save_to_ls)return fileContent=coders.Uint8ArrayToString(new Uint8Array(event.target.result)),_context3.next=4,files.saveFile(file.name,fileContent);_context3.next=4;break;case 4:file.name==lastname&&(files.loadFromSource(new Uint8Array(event.target.result)),ui.setWindowTitle(file.name),document.activeElement.blur(),state.file.name=file.name,state.file.remote_name="",_this2.files.postLoad());case 5:case"end":return _context3.stop()}},_callee3)}));return function(_x){return _ref3.apply(this,arguments)}}(),reader.readAsArrayBuffer(file)})});var bindings={"button-load":function(){var filename=document.getElementById("file-list").value;files.loadLocal(filename)},"button-delete":function(){var filename=document.getElementById("file-list").value;files.deleteFile(filename)},"button-line-numbers":function(){contentBrowser.hide(),lineNumbers.toggle()},"button-goto-line":function(){contentBrowser.hide(),ui.showGotoLinePrompt()},"button-search":function(){state.search.active?(search.deactivateSearchField(),render.update()):(contentBrowser.hide(),search.activateSearchField())},"button-content":function(){return contentBrowser.toggle()},"button-open-copy":function(){return ui.duplicateWindow()}};Object.entries(bindings).forEach(function(_ref4){var _ref5=(0,_slicedToArray2.default)(_ref4,2),id=_ref5[0],handler=_ref5[1];document.getElementById(id).addEventListener("click",handler)})}},{key:"mobileInit",value:(_mobileInit=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee4(){var _this3=this;return _regenerator.default.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",new Promise(function(resolve,reject){var style=document.createElement("link");style.rel="stylesheet",style.type="text/css",style.href=_this3.config.mobile_style_url,style.onload=resolve,style.onerror=reject,document.head.appendChild(style)}));case 1:case"end":return _context4.stop()}},_callee4)})),function(){return _mobileInit.apply(this,arguments)})},{key:"mobileEventsInit",value:function(){var mobileUI=this.mobileUI,contentBrowser=this.contentBrowser,state=this.state,ui=this.ui,lineNumbers=this.lineNumbers,actionDefs={"mobile-menu-close":function(){return mobileUI.closeMenu()},"mobile-menu-open":function(){return mobileUI.openMenu()},"mobile-open-file":function(){document.getElementById("file-select").click(),setTimeout(function(){return mobileUI.closeMenu()},1e3)},"close-content-list-mobile":function(){contentBrowser.hide(),state.is_mobile&&mobileUI.openMenu(!1)},"mobile-toggle-lines":function(){lineNumbers.toggle(),mobileUI.closeMenu()},"mobile-list-content":function(){mobileUI.closeMenu(),contentBrowser.show()},"mobile-goto-line":function(){ui.showGotoLinePrompt(),mobileUI.closeMenu()}};Object.entries(actionDefs).forEach(function(_ref6){var _ref7=(0,_slicedToArray2.default)(_ref6,2),id=_ref7[0],func=_ref7[1];document.getElementById(id).addEventListener("click",func)})}},{key:"canvasInit",value:function(){var state=this.state,scroll=this.scroll,render=this.render,config=this.config,selection=this.selection,mobileUI=this.mobileUI,canvas=document.getElementById("canvas");canvas.addEventListener("click",function(event){state.is_mobile&&mobileUI.toggleMenuButton()}),canvas.addEventListener("mousedown",function(event){var rect=canvas.getBoundingClientRect(),selStartRealX=event.pageX-rect.left,selStartRealY=event.pageY-rect.top;state.selection.x1=scroll.x+Math.round(selStartRealX/config.font_width),state.selection.y1=scroll.y+Math.round(selStartRealY/config.font_height),state.selection.started=!0,state.selection.set=!1,render.update(),event.preventDefault()});var canvasMouseMove=function(event){if(state.selection.started){var rect=document.getElementById("canvas").getBoundingClientRect(),selStartRealX=event.pageX-rect.left,selStartRealY=event.pageY-rect.top;state.selection.x2=scroll.x+Math.round(selStartRealX/config.font_width),state.selection.y2=scroll.y+Math.round(selStartRealY/config.font_height),state.selection.x2!=state.selection.x1&&state.selection.y1!=state.selection.y2?state.selection.set=!0:state.selection.set=!1,render.update()}};canvas.addEventListener("mousemove",canvasMouseMove),canvas.addEventListener("mouseup",function(event){canvasMouseMove(event);try{var range=document.createRange();window.getSelection().addRange(range),state.selection.started=!1}catch(e){console.log(e)}}),document.addEventListener("copy",function(event){var selectionText=selection.getSelectionText();null!==selectionText&&(event.clipboardData.setData("text/plain",selectionText),event.preventDefault(),window.getSelection().removeAllRanges(),selection.clear(),render.update())})}}]),App}()},{"./coders":17,"./config-default":18,"./content-browser.js":19,"./export":21,"./files":22,"./font":23,"./line-numbers":25,"./mobile-ui":26,"./parser":27,"./render":28,"./screen":29,"./scroll":30,"./search":31,"./selection":32,"./state":33,"./ui":34,"./uri-hash":35,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/helpers/slicedToArray":8,"@babel/runtime/helpers/typeof":9,"@babel/runtime/regenerator":10,mousetrap:14}],17:[function(require,module,exports){"use strict";var _require=require("./cp866.js"),charToByteCP866=_require.charToByteCP866,byteToCharCP866=_require.byteToCharCP866;module.exports={Uint8ArrayToString:function(ui8arr){return Array.prototype.map.call(ui8arr,function(b){return byteToCharCP866[b]}).join("")},stringToUint8Array:function(string){return new Uint8Array(string.split("").map(function(c){return charToByteCP866[c]}))},Uint8Array2BinArray:function(uarr){var result=[];return uarr.forEach(function(byte){for(var ix=128;0!==ix;)result.push(byte&ix),ix>>=1}),result},binArray2String:function(arr){for(var result="",arrlen=arr.length;arr.length%8;)arr.push(0);for(var i=0;i<arr.length;){for(var b="";b.length<8&&void 0!==arr[i];)b+=arr[i],i++;var c=parseInt(b,2);result+=String.fromCharCode(c)}return arrlen+":"+result},string2BinArray:function(string){string.substr(0,string.indexOf(":"));var charCode,bits,result=[];return(string=string.substr(string.indexOf(":")+1)).split("").forEach(function(char){charCode=char.charCodeAt(0),bits=charCode.toString(2).split("").map(function(x){return Number(x)}),new Array(8-bits.length).fill(0).forEach(function(bit){return result.push(bit)}),bits.forEach(function(bit){return result.push(bit)})}),result}}},{"./cp866.js":20}],18:[function(require,module,exports){"use strict";module.exports={app_full_name:"Lexicon Viewer App",font_width:8,font_height:19,fonts:["public/fonts/VGA0.SFN","public/fonts/VGA1.SFN","public/fonts/VGA2.SFN","public/fonts/VGA3.SFN","public/fonts/VGA4.SFN","public/fonts/VGA5.SFN","public/fonts/VGA6.SFN","public/fonts/VGA7.SFN","public/fonts/VGA8.SFN","public/fonts/VGA9.SFN","public/fonts/VGA10.SFN","public/fonts/VGA11.SFN"],load_fonts_from_source:!0,show_line_numbers:!0,fg_color:[0,0,0,255],bg_color:[255,255,255,255],selection_fill_color:[0,0,255,100],search_fill_color:[255,255,0,100],search_active_fill_color:[0,255,0,100],line_numbers_padding:2,ctrl_scroll_k:8,blank_lines:10,blank_characters_on_eol:5,mobile_style_url:"public/css/mobile.css",hide_top_bar_delta:10,show_top_bar_delta:10,load_greeting_file_from_source:!0,greeting_file:"public/startPage/info.txt",content_list_url:"api?action=listdir&dir=",content_real_path:"api?action=getfile&file=",export_png_file_name_prefix:"lex_",export_clear_selection:!0,parser:{fonts:{48:0,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,205:10},underline_true:95,underline_false:46,empty_line:232,command:255},uri_hash_update_delay:500,save_file_source:!1,ls_file_prefix:"file_",save_to_ls:!0,search_mode:"case-insensitive"}},{}],19:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function ContentBrowser(app){(0,_classCallCheck2.default)(this,ContentBrowser),this.app=app}var _update,_show;return(0,_createClass2.default)(ContentBrowser,[{key:"show",value:(_show=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var json,_this=this;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.update().catch(function(err){_this.app.log("ContentBrowser.show",err),_this.app.alert("[Error while loading contents]: is webserver up and running?")});case 2:return json=_context.sent,_context.next=5,this.load(json);case 5:this.app.state.content_list.active=!0,document.getElementById("content-list-container").style.display="block";case 7:case"end":return _context.stop()}},_callee,this)})),function(){return _show.apply(this,arguments)})},{key:"hide",value:function(){this.app.state.content_list.active=!1,document.getElementById("content-list-container").style.display="none"}},{key:"toggle",value:function(){this[this.app.state.content_list.active?"hide":"show"]()}},{key:"scrollIfNeeded",value:function(element,container){if(element.offsetTop<container.scrollTop)container.scrollTop=element.offsetTop;else{var offsetBottom=element.offsetTop+element.offsetHeight;container.scrollTop+container.offsetHeight<offsetBottom&&(container.scrollTop=offsetBottom-container.offsetHeight)}}},{key:"navigate",value:function(where){var _this2=this,trs=Array.from(document.querySelectorAll("#content-list-table > tr"));if(trs.length){var setActive=function(el){var old=document.querySelector(".content-list-active");old&&old.classList.remove("content-list-active"),el.classList.add("content-list-active"),_this2.scrollIfNeeded(el,document.querySelector("#content-list-container"))};if(document.querySelector(".content-list-active"))if("top"===where)setActive(trs[0]);else if("bottom"===where)setActive(trs.pop());else{for(var active=0,_arr=trs,_i=0;_i<_arr.length;_i++){if(_arr[_i].matches(".content-list-active"))break;active++}var to=active+where;to<0?to=0:to>=trs.length&&(to=trs.length-1),setActive(trs[to])}else setActive(trs[0])}}},{key:"update",value:(_update=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(){var response;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return document.getElementById("content-list").textContent="Loading...",_context2.next=3,fetch(this.app.config.content_list_url+this.app.state.content_list.path);case 3:return response=_context2.sent,_context2.abrupt("return",response.json());case 5:case"end":return _context2.stop()}},_callee2,this)})),function(){return _update.apply(this,arguments)})},{key:"load",value:function(list){var _this3=this,_this$app=this.app,ui=_this$app.ui,state=_this$app.state,config=_this$app.config,files=_this$app.files,content_list=document.getElementById("content-list");content_list.innerHTML="";var table=document.createElement("table");table.id="content-list-table",state.content_list.path.length&&(list=[{type:"parent"}].concat(list));list.forEach(function(sth){var row=document.createElement("tr");row.classList.add("content-list-item");var filename=sth.name,icon_td=document.createElement("td"),icon=document.createElement("div");icon.className="content-list-icon content-list-icon-"+sth.type,icon_td.appendChild(icon),icon_td.style.width="22px",row.appendChild(icon_td);var name_td=document.createElement("td");if(name_td.classList.add("content-list-item-name"),row.appendChild(name_td),["directory","file"].includes(sth.type)){if(name_td.textContent=filename,state.content_list.path+"/"+filename==state.file.remote_name&&row.classList.add("content-list-active"),!state.is_mobile){var modTime=document.createElement("td");modTime.className="file-list-mod-time",modTime.textContent=new Date(sth.modified).toISOString().slice(0,16).replace(/T/," "),row.appendChild(modTime)}}else name_td.textContent="..";"directory"===sth.type?row.onclick=function(){"/"===state.content_list.path?state.content_list.path+=filename:state.content_list.path+="/"+filename,_this3.show()}:"file"===sth.type?row.onclick=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(){var url;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return url=config.content_real_path+state.content_list.path+"/"+filename,_context3.prev=1,_context3.next=4,files.loadRemote(url,state.content_list.path+"/"+filename);case 4:ui.setWindowTitle(filename),state.file.name=filename,_this3.hide(),_context3.next=13;break;case 9:_context3.prev=9,_context3.t0=_context3.catch(1),console.log(_context3.t0),"string"==typeof _context3.t0?_this3.app.alert(_context3.t0):(_this3.app.alert("Error opening remote file!"),console.log(_context3.t0));case 13:case"end":return _context3.stop()}},_callee3,null,[[1,9]])})):row.onclick=function(){state.content_list.path=state.content_list.path.split("/").slice(0,-1).join("/")||"/",_this3.show()},table.appendChild(row)}),content_list.appendChild(table)}},{key:"active",get:function(){return this.app.state.content_list.active}}]),ContentBrowser}()},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10}],20:[function(require,module,exports){"use strict";module.exports={charToByteCP866:{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,"\0":0,"":1,"":2,"":3,"":4,"":5,"":6,"":7,"\b":8,"\t":9,"\n":10,"\v":11,"\f":12,"\r":13,"":14,"":15,"":16,"":17,"":18,"":19,"":20,"":21,"":22,"":23,"":24,"":25,"":26,"":27,"":28,"":29,"":30,"":31," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"":127,"":128,"":129,"":130,"":131,"":132,"":133,"":134,"":135,"":136,"":137,"":138,"":139,"":140,"":141,"":142,"":143,"":144,"":145,"":146,"":147,"":148,"":149,"":150,"":151,"":152,"":153,"":154,"":155,"":156,"":157,"":158,"":159,"":160,"":161,"":162,"":163,"":164,"":165,"":166,"":167,"":168,"":169,"":170,"":171,"":172,"":173,"":174,"":175,"":176,"":177,"":178,"":179,"":180,"":181,"":182,"":183,"":184,"":185,"":186,"":187,"":188,"":189,"":190,"":191,"":192,"":193,"":194,"":195,"":196,"":197,"":198,"":199,"":200,"":201,"":202,"":203,"":204,"":205,"":206,"":207,"":208,"":209,"":210,"":211,"":212,"":213,"":214,"":215,"":216,"":217,"":218,"":219,"":220,"":221,"":222,"":223,"":224,"":225,"":226,"":227,"":228,"":229,"":230,"":231,"":232,"":233,"":234,"":235,"":236,"":237,"":238,"":239,"":240,"":241,"":242,"":243,"":244,"":245,"":246,"":247,"":248,"":249,"":250,"":251,"":252,"":253,"":254,"":255},byteToCharCP866:{0:"\0",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"\b",9:"\t",10:"\n",11:"\v",12:"\f",13:"\r",14:"",15:"",16:"",17:"",18:"",19:"",20:"",21:"",22:"",23:"",24:"",25:"",26:"",27:"",28:"",29:"",30:"",31:"",32:" ",33:"!",34:'"',35:"#",36:"$",37:"%",38:"&",39:"'",40:"(",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"`",97:"a",98:"b",99:"c",100:"d",101:"e",102:"f",103:"g",104:"h",105:"i",106:"j",107:"k",108:"l",109:"m",110:"n",111:"o",112:"p",113:"q",114:"r",115:"s",116:"t",117:"u",118:"v",119:"w",120:"x",121:"y",122:"z",123:"{",124:"|",125:"}",126:"~",127:"",128:"",129:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",141:"",142:"",143:"",144:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",157:"",158:"",159:"",160:"",161:"",162:"",163:"",164:"",165:"",166:"",167:"",168:"",169:"",170:"",171:"",172:"",173:"",174:"",175:"",176:"",177:"",178:"",179:"",180:"",181:"",182:"",183:"",184:"",185:"",186:"",187:"",188:"",189:"",190:"",191:"",192:"",193:"",194:"",195:"",196:"",197:"",198:"",199:"",200:"",201:"",202:"",203:"",204:"",205:"",206:"",207:"",208:"",209:"",210:"",211:"",212:"",213:"",214:"",215:"",216:"",217:"",218:"",219:"",220:"",221:"",222:"",223:"",224:"",225:"",226:"",227:"",228:"",229:"",230:"",231:"",232:"",233:"",234:"",235:"",236:"",237:"",238:"",239:"",240:"",241:"",242:"",243:"",244:"",245:"",246:"",247:"",248:"",249:"",250:"",251:"",252:"",253:"",254:"",255:""}}},{}],21:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),saveAs=require("file-saver").saveAs;module.exports=function(){function Export(app){(0,_classCallCheck2.default)(this,Export),this.app=app,this.saveAs=saveAs}return(0,_createClass2.default)(Export,[{key:"makeCanvas",value:function(x1,x2,y1,y2){var config=this.app.config,state=this.app.state,h=y2-y1,rw=(x2-x1)*config.font_width,rh=h*config.font_height,canvas=document.createElement("canvas");canvas.width=rw,canvas.height=rh;var context=canvas.getContext("2d");context.createImageData(rw,rh);context.fillStyle="rgba("+config.bg_color[0]+","+config.bg_color[1]+","+config.bg_color[2]+","+config.bg_color[3]+")",context.fillRect(0,0,rw,rh);for(var y=y1;y<y2&&y<state.file.lines.length;y++){var line=state.file.lines[y];if(void 0===line)break;line=this.app.parser.parseLine(line);for(var x=x1;x<line.length&&x<x2;x++){var char=line[x].char,underline=line[x].underline,font=line[x].font;state.fonts[font].bitmaps[char]&&(context.putImageData(state.fonts[font].bitmaps[char],(x-x1)*config.font_width,(y-y1)*config.font_height),underline&&this.app.render.underlineChar(char,font,x-x1,y-y1,context))}}return canvas}},{key:"toPNG",value:function(){var _this=this;if(this.app.state.selection.set){var s=this.app.state.selection;this.makeCanvas(Math.min(s.x1,s.x2),Math.max(s.x1,s.x2),Math.min(s.y1,s.y2),Math.max(s.y1,s.y2)).toBlob(function(blob){_this.saveAs(blob,_this.exportFileName())}),this.app.config.export_clear_selection&&(this.app.selection.clear(),this.app.render.update())}}},{key:"exportFileName",value:function(ext){var state=this.app.state;return this.app.config.export_png_file_name_prefix+(state.file.name?state.file.name:"local").trim().replace(/[^a-z0-9]/gi,"_").replace(/_{2,}/gi,"_")+".png"}}]),Export}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"file-saver":12}],22:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),localforage=require("localforage");module.exports=function(){function Files(app,localforage){(0,_classCallCheck2.default)(this,Files),this.app=app}var _loadRemote,_deleteFile,_saveFile;return(0,_createClass2.default)(Files,[{key:"isLSFileName",value:function(filename){return filename.startsWith(this.app.config.ls_file_prefix)}},{key:"LSFileNameToFileName",value:function(filename){return filename.substr(this.app.config.ls_file_prefix.length)}},{key:"getFileList",value:function(){var _this=this;return localforage.keys().then(function(value){var filtered=[];for(var i in value){var item=value[i];_this.isLSFileName(item)&&filtered.push(_this.LSFileNameToFileName(item))}return filtered})}},{key:"saveFile",value:(_saveFile=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(filename,source){return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,localforage.setItem(this.app.config.ls_file_prefix+filename,source);case 2:return _context.sent,_context.next=5,this.app.ui.updateFileList();case 5:case"end":return _context.stop()}},_callee,this)})),function(_x,_x2){return _saveFile.apply(this,arguments)})},{key:"deleteFile",value:(_deleteFile=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(filename){return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,localforage.removeItem(this.app.config.ls_file_prefix+filename);case 2:return _context2.next=4,this.app.ui.updateFileList();case 4:case"end":return _context2.stop()}},_callee2,this)})),function(_x3){return _deleteFile.apply(this,arguments)})},{key:"pushSelectedToLS",value:function(file){var _this2=this,reader=new FileReader;reader.onload=function(event){_this2.saveFile(file.name,_this2.app.coders.Uint8ArrayToString(event.target.result))},reader.readAsArrayBuffer(file)}},{key:"loadLocal",value:function(filename){var _this3=this,_this$app=this.app,coders=_this$app.coders,state=_this$app.state,ui=_this$app.ui;return localforage.getItem(this.app.config.ls_file_prefix+filename).then(function(contents){_this3.loadFromSource(coders.stringToUint8Array(contents)),ui.setWindowTitle(filename),state.file.name=filename,state.file.remote_name="",_this3.postLoad()})}},{key:"loadRemote",value:(_loadRemote=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee3(url,remoteName){var response,buffer;return _regenerator.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,fetch(url);case 2:if(200===(response=_context3.sent).status)return _context3.next=6,response.arrayBuffer();_context3.next=12;break;case 6:buffer=_context3.sent,this.loadFromSource(buffer),this.app.state.file.remote_name=remoteName,this.postLoad(),_context3.next=21;break;case 12:if(400===response.status)throw"No access to remote file!";_context3.next=16;break;case 16:if(404===response.status)throw"Remote file not found!";_context3.next=20;break;case 20:throw"Couldn't load remote file (".concat(response.status,")");case 21:case"end":return _context3.stop()}},_callee3,this)})),function(_x4,_x5){return _loadRemote.apply(this,arguments)})},{key:"loadFromSource",value:function(source){source=new Uint8Array(source),this.app.config.save_file_source?this.app.state.file.source=source:this.app.state.file.source=new Uint8Array,this.app.state.file.lines=[new Uint8Array];for(var lineBytes=[],i=0;i<source.byteLength;i++)13==source[i]?(this.app.state.file.lines.push(new Uint8Array(lineBytes)),lineBytes=[],i++):lineBytes.push(source[i]);return this.app.state.file.lines.push(new Uint8Array(lineBytes)),this.app.state.file}},{key:"postLoad",value:function(){var _this$app2=this.app,search=_this$app2.search,scroll=_this$app2.scroll,state=_this$app2.state,lineNumbers=_this$app2.lineNumbers,selection=_this$app2.selection,URIHashControl=_this$app2.URIHashControl,render=_this$app2.render,screen=_this$app2.screen;search.rebuildIndex(),search.close(),scroll.y=0,scroll.x=0,state.numbers.set&&lineNumbers.add(),URIHashControl.update(),selection.clear(),scroll.update(),screen.update(),render.update()}}]),Files}()},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10,localforage:13}],23:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_require=require("./coders"),string2BinArray=_require.string2BinArray,Uint8Array2BinArray=_require.Uint8Array2BinArray;module.exports=function(){function FontControl(app){(0,_classCallCheck2.default)(this,FontControl),this.app=app}var _loadFont;return(0,_createClass2.default)(FontControl,[{key:"setFont",value:function(ix,binArray){this.app.state.fonts[ix]={source:binArray,bitmaps:{}}}},{key:"loadFont",value:(_loadFont=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(path,ix){var response,buffer;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("undefined"!=typeof preloadedFonts&&preloadedFonts[ix])return this.setFont(ix,string2BinArray(preloadedFonts[ix])),this.app.log("Loaded font ".concat(ix," from preloaded fonts")),_context.abrupt("return");_context.next=4;break;case 4:return _context.next=6,fetch(path);case 6:return response=_context.sent,_context.next=9,response.arrayBuffer();case 9:buffer=_context.sent,this.setFont(ix,Uint8Array2BinArray(new Uint8Array(buffer))),this.app.log("Loaded font ".concat(ix," from remote path ").concat(path));case 12:case"end":return _context.stop()}},_callee,this)})),function(_x,_x2){return _loadFont.apply(this,arguments)})}]),FontControl}()},{"./coders":17,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10}],24:[function(require,module,exports){"use strict";var App=require("./app"),attachFastClick=require("fastclick");try{attachFastClick(document.body)}catch(e){console.log(e)}var init=function(){(window.app=new App).init()};"interactive"===document.readyState||"complete"===document.readyState?init():document.addEventListener("DOMContentLoaded",init)},{"./app":16,fastclick:11}],25:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function LineNumbers(app){(0,_classCallCheck2.default)(this,LineNumbers),this.app=app}return(0,_createClass2.default)(LineNumbers,[{key:"remove",value:function(){for(var _this$app=this.app,config=_this$app.config,state=_this$app.state,render=_this$app.render,search=_this$app.search,scroll=_this$app.scroll,screen=_this$app.screen,i=0;i<state.file.lines.length;i++)state.file.lines[i]=new Uint8Array(Array.prototype.slice.call(state.file.lines[i],state.numbers.width+2));state.index.maxlen-=state.numbers.width+config.line_numbers_padding,state.numbers.set=!1,state.numbers.width=0,search.close(),screen.update(),scroll.update(),render.update()}},{key:"add",value:function(){var _this$app2=this.app,config=_this$app2.config,state=_this$app2.state,parser=(_this$app2.render,_this$app2.search,_this$app2.parser);_this$app2.scroll,_this$app2.screen;state.numbers.width=(state.file.lines.length+"").length+1,state.numbers.set=!0;for(var i=0;i<state.file.lines.length;i++)state.file.lines[i]=new Uint8Array(parser.getLineNumberBytes(i,state.numbers.width).concat(Array.prototype.slice.call(state.file.lines[i])));state.index.maxlen+=state.numbers.width+config.line_numbers_padding}},{key:"toggle",value:function(){this.app.state.numbers.set?this.remove():this.add()}}]),LineNumbers}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],26:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function MobileUI(app){(0,_classCallCheck2.default)(this,MobileUI),this.app=app,this.isButtonShown=!0}var _setFileList;return(0,_createClass2.default)(MobileUI,[{key:"openMenu",value:function(showRemote){this.setFileList(showRemote),document.getElementById("mobile-menu").style.display="block"}},{key:"setFileList",value:(_setFileList=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var showRemote,elem,list,_this=this,_args=arguments;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return showRemote=!(0<_args.length&&void 0!==_args[0])||_args[0],elem=document.getElementById("mobile-file-list"),_context.next=4,this.app.files.getFileList();case 4:if(list=_context.sent,elem.innerHTML=list.length?"":'<span id="no-local-files-warning">No local files</span>',!list.length&&showRemote)return this.closeMenu(),this.app.contentBrowser.show(),_context.abrupt("return");_context.next=10;break;case 10:list.forEach(function(fileName){var container=document.createElement("div");container.className="mobile-file-item mobile-menu-item";var name=document.createElement("span");name.textContent=fileName,name.title="Load ".concat(fileName),name.className="mobile-file-name",name.addEventListener("click",function(){_this.app.files.loadLocal(fileName),_this.closeMenu()});var deleteFile=document.createElement("div");deleteFile.className="mobile-icon large mobile-delete-file",deleteFile.id="mobile-delete-file",deleteFile.title="Delete ".concat(fileName),deleteFile.addEventListener("click",function(){_this.app.files.deleteFile(fileName),container.remove()}),elem.appendChild(container),container.appendChild(name),container.appendChild(deleteFile)});case 11:case"end":return _context.stop()}},_callee,this)})),function(){return _setFileList.apply(this,arguments)})},{key:"closeMenu",value:function(){document.getElementById("mobile-menu").style.display="none",this.app.render.update()}},{key:"showMenuButton",value:function(){document.getElementById("mobile-menu-open").style.top=0,document.getElementById("block-top").style.top=0,this.isButtonShown=!0}},{key:"hideMenuButton",value:function(){document.getElementById("mobile-menu-open").style.top="-100px",document.getElementById("block-top").style.top="-100px",this.isButtonShown=!1}},{key:"toggleMenuButton",value:function(){this.isButtonShown?this.hideMenuButton():this.showMenuButton()}}]),MobileUI}()},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10}],27:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function Parser(app){(0,_classCallCheck2.default)(this,Parser),this.app=app}return(0,_createClass2.default)(Parser,[{key:"parseLine",value:function(line){for(var r=[],font=0,command=!1,underline=!1,config=this.app.config,x=0;x<line.length;x++){var char=line[x];if(command)switch(command=0,char){case config.parser.underline_false:underline=!1;break;case config.parser.underline_true:underline=!0;break;case config.parser.empty_line:return r;default:void 0!==config.parser.fonts[char]&&(font=config.parser.fonts[char])}else 255===char?command=!0:r.push({char:char,underline:underline,font:font})}return r}},{key:"getLineNumberBytes",value:function(num,width){var r="                    ",result=[];num+="",r=r.substr(0,width-num.length),r+=num;for(var i=0;i<r.length;i++)" "==r[i]?result.push(32):result.push(1*r[i]+48);return result.push(179),result.push(32),result}}]),Parser}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],28:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function Render(app){(0,_classCallCheck2.default)(this,Render),this.app=app,this.resetState()}return(0,_createClass2.default)(Render,[{key:"resetState",value:function(){this.state=null}},{key:"setFontBGColor",value:function(bg_color){this.app.config.bg_color=bg_color,this.update()}},{key:"setFontFGColor",value:function(fg_color){this.app.config.fg_color=fg_color,this.update()}},{key:"makeImageData",value:function(){if(!this.app.config.load_fonts_from_source||this.app.state.fonts.every(function(f){return!!f.source})){var _this$app=this.app,config=_this$app.config,state=_this$app.state,fontWidth=config.font_width,fontHeight=config.font_height,canvas=document.createElement("canvas");canvas.width=fontWidth,canvas.height=fontHeight;var context=canvas.getContext("2d"),imageData=context.getImageData(0,0,fontWidth,fontHeight);state.fonts.forEach(function(font,ix){for(var charCode=0;charCode<256;charCode++){for(var shift=fontWidth*fontHeight*charCode,charImageData=context.createImageData(imageData),y=(String.fromCharCode(charCode),0);y<fontHeight;y++)for(var x=0;x<fontWidth;x++){var bits=font.source[shift+y*fontWidth+x]?config.fg_color:config.bg_color,pos=4*(fontWidth*y+x);charImageData.data[pos]=bits[0],charImageData.data[pos+1]=bits[1],charImageData.data[pos+2]=bits[2],charImageData.data[pos+3]=bits[3]}state.fonts[ix].bitmaps[charCode]=charImageData}})}}},{key:"underlineChar",value:function(char,font,x,y,context){for(var _this$app2=this.app,config=_this$app2.config,state=_this$app2.state,underscoreID=state.fonts[4].bitmaps[95],charID=state.fonts[font].bitmaps[char],mixedID=context.createImageData(underscoreID),i=0;i<underscoreID.data.length;i+=4)for(var j=0;j<4;j++)underscoreID.data[i+j]==config.fg_color[j]||charID.data[i+j]==config.fg_color[j]?mixedID.data[i+j]=config.fg_color[j]:mixedID.data[i+j]=config.bg_color[j];context.putImageData(mixedID,x*config.font_width,y*config.font_height)}},{key:"updateCanvas",value:function(context){var _this$app3=this.app,config=_this$app3.config,screen=_this$app3.screen,state=_this$app3.state,parser=_this$app3.parser,scroll=_this$app3.scroll,textWidth=screen.w,textHeight=screen.h,pixelWidth=textWidth*config.font_width,pixelHeight=textHeight*config.font_height,xShift=scroll.x,yShift=scroll.y,start=0,end=textHeight;if(this.state){var _this$state=this.state,x_shift=_this$state.x-xShift,y_shift=_this$state.y-yShift;if(Math.abs(y_shift)<textHeight){var id=context.getImageData(0,0,pixelWidth,pixelHeight);context.putImageData(id,x_shift*config.font_width,y_shift*config.font_height),y_shift<0?(start=textHeight+y_shift,end=textHeight):0<y_shift&&(start=0,end=y_shift)}}else context.fillRect(0,0,pixelWidth,pixelHeight);context.fillRect(0,start*config.font_height,pixelWidth,(end-start)*config.font_height),this.state={x:xShift,y:yShift};for(var linesCount=state.file.lines.length,y=start;y<end&&y<textHeight&&y+yShift<linesCount;y++){var line=state.file.lines[y+yShift];if(void 0===line)break;line=parser.parseLine(line);for(var x=0;x<line.length;x++){var char=line[x].char,underline=line[x].underline,font=line[x].font;state.fonts[font].bitmaps[char]&&(context.putImageData(state.fonts[font].bitmaps[char],(x-xShift)*config.font_width,y*config.font_height),underline&&this.underlineChar(char,font,x-xShift,y,context))}}}},{key:"updateSelection",value:function(context){var _this$app4=this.app,config=_this$app4.config,state=_this$app4.state,scroll=_this$app4.scroll;if(state.selection.set){var t=config.selection_fill_color;context.fillStyle="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]/255+")",context.fillRect((state.selection.x1-scroll.x)*config.font_width,(state.selection.y1-scroll.y)*config.font_height,(state.selection.x2-state.selection.x1)*config.font_width,(state.selection.y2-state.selection.y1)*config.font_height)}this.resetState()}},{key:"updateSearchResults",value:function(context){var _this$app5=this.app,screen=_this$app5.screen,scroll=_this$app5.scroll,config=_this$app5.config,search=_this$app5.state.search;1==search.active&&search.results.forEach(function(blocks,resultIndex){blocks.forEach(function(block){var scrollY=scroll.y;if(block.line>=scrollY&&block.line<=scrollY+screen.h){var style=config["search_"+(resultIndex==search.activeResult?"active_":"")+"fill_color"];context.fillStyle="rgba("+style[0]+","+style[1]+","+style[2]+","+style[3]/255+")",context.fillRect((block.start-scroll.x)*config.font_width,(block.line-scroll.y)*config.font_height,block.length*config.font_width,config.font_height)}})}),this.resetState()}},{key:"update",value:function(){var _this$app6=this.app,config=_this$app6.config,ui=(_this$app6.state,_this$app6.ui),context=document.getElementById("canvas").getContext("2d");context.fillStyle="rgba("+config.bg_color[0]+","+config.bg_color[1]+","+config.bg_color[2]+","+config.bg_color[3]+")",ui.updateBottomBlock(),this.updateCanvas(context),this.updateSelection(context),this.updateSearchResults(context)}}]),Render}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],29:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function Screen(app){(0,_classCallCheck2.default)(this,Screen),this.app=app,this.h=0,this.w=0}return(0,_createClass2.default)(Screen,[{key:"getViewportSize",value:function(){return{w:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}},{key:"update",value:function(){var _this$app=this.app,state=_this$app.state,config=_this$app.config,render=_this$app.render,viewport=this.getViewportSize(),canvas=document.getElementById("canvas"),hShift=state.is_mobile?document.getElementById("block-bottom").getBoundingClientRect().height:document.getElementById("block-top").getBoundingClientRect().height+document.getElementById("block-bottom").getBoundingClientRect().height;this.h=Math.ceil((viewport.h-hShift)/config.font_height),this.w=Math.ceil(viewport.w/config.font_width);var realHeight=Math.ceil(viewport.h-hShift);canvas.height=realHeight,canvas.width=Math.ceil(viewport.w),document.getElementById("canvas-container").style.height=realHeight+"px",document.getElementById("canvas-scroll-container").style.height=realHeight+"px",render.resetState()}}]),Screen}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],30:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function Scroll(app){var _this=this;(0,_classCallCheck2.default)(this,Scroll),this.app=app,this.container=document.getElementById("canvas-scroll-container"),this.container.addEventListener("scroll",function(){return _this.fromScrollBar()}),this.requestAnimationFrame=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(f){return f()}).bind(window)}return(0,_createClass2.default)(Scroll,[{key:"fromScrollBar",value:function(){var dx=this.container.scrollLeft,dy=this.container.scrollTop,_this$app=this.app,render=(_this$app.config,_this$app.screen,_this$app.render),URIHashControl=_this$app.URIHashControl;this.requestAnimationFrame(function(){document.getElementById("canvas-container").style.transform="translate("+dx+"px, "+dy+"px)",render.update()}),URIHashControl.update()}},{key:"toBeginning",value:function(){this.y=0,this.update()}},{key:"toEnd",value:function(){this.y=this.app.state.file.lines.length,this.update()}},{key:"moveY",value:function(value){this.y+=value,this.update()}},{key:"moveX",value:function(value){this.x+=value,this.update()}},{key:"update",value:function(){var _this$app2=this.app,state=_this$app2.state,screen=_this$app2.screen,config=_this$app2.config,height=state.file.lines.length,width=Math.max(screen.w-5,state.index.maxlen+config.blank_characters_on_eol);document.getElementById("canvas-large-container").style.height=height*config.font_height+"px",document.getElementById("canvas-large-container").style.width=width*config.font_width+"px"}},{key:"x",get:function(){return Math.round(this.container.scrollLeft/this.app.config.font_width)},set:function(value){var _this$app3=this.app,screen=_this$app3.screen,state=_this$app3.state,config=_this$app3.config,index=(_this$app3.scroll,state.index),maxXScroll=screen.w-index.maxlen;0<maxXScroll&&maxXScroll<value&&(value=maxXScroll),value<0&&(value=0),this.container.scrollLeft=Math.round(value*config.font_width)}},{key:"y",get:function(){var _this$app4=this.app,state=_this$app4.state,config=_this$app4.config,fileHeight=state.file.lines.length,coeff=(fileHeight+config.blank_lines)/fileHeight;return Math.round(coeff*this.container.scrollTop/this.app.config.font_height)},set:function(value){var _this$app5=this.app,screen=_this$app5.screen,state=_this$app5.state,config=_this$app5.config,fileHeight=(_this$app5.scroll,state.file.lines.length),coeff=(fileHeight+config.blank_lines)/fileHeight;if(value<0)value=0;else if(screen.h>fileHeight){var maxYScroll=fileHeight-screen.h;maxYScroll<value&&(value=maxYScroll)}this.container.scrollTop=Math.round(value*config.font_height/coeff)}}]),Scroll}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],31:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function SearchControl(app){(0,_classCallCheck2.default)(this,SearchControl),this.app=app,this.searchField=document.getElementById("search-field"),this.container=document.getElementById("block-search")}return(0,_createClass2.default)(SearchControl,[{key:"search",value:function(text,str){switch(this.app.state.search.mode){case"default":return this.searchDefault(text,str);case"case-insensitive":return this.searchCaseInsensitive(text,str);default:throw"SearchControl.search: incorrect mode"}}},{key:"searchDefault",value:function(text,str){for(var c,line,_this$app=this.app,state=_this$app.state,config=_this$app.config,n=0,r=[],tr=[],lines=text.split("\n"),tn=0,lineNumbersWidth=state.numbers.set?state.numbers.width+config.line_numbers_padding:0,y=0;y<lines.length;y++)for(;lines[y].length&&(lines[y].endsWith("-")||lines[y].endsWith(" "));)lines[y]=lines[y].slice(0,-1);for(y=0;y<lines.length;y++){line=lines[y];for(var ix=0;ix<line.length&&-1!=" -".indexOf(line[ix]);)ix++;for(var x=ix;x<line.length;x++)(c=line[x])!=str[n]&&(tr=[],tn=n=0),c==str[n]&&(n<str.length&&(n++,tn++),n==str.length&&(tr.push({line:y,start:x-tn+1+lineNumbersWidth,length:tn}),r.push(tr),tr=[],tn=n=0));n&&(tr.push({line:y,start:x-tn+lineNumbersWidth,length:tn}),tn=0)}return r}},{key:"searchCaseInsensitive",value:function(text,str){return text=text.toLowerCase(),str=str.toLowerCase(),this.searchDefault(text,str)}},{key:"activateSearchField",value:function(){var _this=this;this.app.state.search.active=!0,this.container.style.display="block",setTimeout(function(){_this.searchField.focus()},10),this.app.render.update()}},{key:"deactivateSearchField",value:function(){this.app.state.search.active=!1,this.container.style.display="none",this.searchField.blur()}},{key:"clearSearchField",value:function(){this.searchField.value=""}},{key:"updateSearchBlock",value:function(){var number=0==this.app.state.search.results.length?0:this.app.state.search.activeResult+1,total=number?this.app.state.search.results.length:0;document.getElementById("search-number").textContent=number,document.getElementById("search-total").textContent=total}},{key:"jumpToIndex",value:function(index){index<this.app.state.search.results.length-1&&(this.app.state.search.activeResult=index),this.app.state.search.results[index]?this.scrollToCurrentResult():this.app.state.search.activeResult=this.app.state.search.results.length-1}},{key:"scrollToCurrentResult",value:function(){var index=this.app.state.search.activeResult,arr=this.app.state.search.results[index];if(arr){var line=arr[arr.length-1].line-1,scrollY=this.app.scroll.y;(line<scrollY||line>scrollY+this.app.screen.h/2)&&(this.app.scroll.y=line,this.app.render.update())}}},{key:"searchNext",value:function(){var search=this.app.state.search;search.activeResult<search.results.length-1?search.activeResult++:search.activeResult=0,this.jumpToIndex(search.activeResult),this.updateSearchBlock()}},{key:"searchPrevious",value:function(){var search=this.app.state.search;0<search.activeResult?search.activeResult--:search.activeResult=search.results.length-1,this.jumpToIndex(search.activeResult),this.updateSearchBlock()}},{key:"close",value:function(){this.app.state.search.active=!1,this.app.state.search.activeResult=0,this.app.state.search.results=[],this.updateSearchBlock(),this.clearSearchField(),this.deactivateSearchField()}},{key:"performSearch",value:function(){this.performSearchByFunction(),this.updateSearchBlock(),this.app.render.update()}},{key:"performSearchByFunction",value:function(){var text=this.app.state.index.text,str=this.searchField.value;this.app.state.search.results=this.search(text,str),this.scrollToCurrentResult()}},{key:"rebuildIndex",value:function(){var _this$app2=this.app,state=_this$app2.state,parser=_this$app2.parser,coders=_this$app2.coders;state.index.text="";for(var i=state.index.maxlen=0;i<state.file.lines.length;i++){var parsed=parser.parseLine(state.file.lines[i]),line=coders.Uint8ArrayToString(parsed.map(function(c){return c.char}));state.index.text+=line+"\n",state.index.maxlen<line.length&&(state.index.maxlen=line.length)}}}]),SearchControl}()},{"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],32:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),byteToCharCP866=require("./cp866.js").byteToCharCP866;module.exports=function(){function SelectionControl(app){(0,_classCallCheck2.default)(this,SelectionControl),this.app=app}return(0,_createClass2.default)(SelectionControl,[{key:"clear",value:function(){this.app.state.selection={set:!1,started:!1,x1:0,y1:0,x2:0,y2:0}}},{key:"getSelectionText",value:function(){var _this$app=this.app,state=_this$app.state,parser=_this$app.parser;if(!state.selection.set)return null;var selection=state.selection,x1=Math.min(selection.x1,selection.x2),x2=Math.max(selection.x1,selection.x2),y1=Math.min(selection.y1,selection.y2),y2=Math.max(selection.y1,selection.y2),lines=state.file.lines,result=[];if(x1==x2||y1==y2)return null;for(var y=y1;y<y2;y++)if(lines[y]){for(var line=parser.parseLine(lines[y]),lineResult="",x=x1;x<x2&&x<line.length;x++)line[x]?lineResult+=byteToCharCP866[line[x].char]:lineResult+=" ";result.push(lineResult)}return result.join("\n")}}]),SelectionControl}()},{"./cp866.js":20,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5}],33:[function(require,module,exports){"use strict";module.exports=function(app){app.state={is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test((navigator||{}).userAgent||""),fonts:app.config.fonts.map(function(){}),file:{name:"",remote_name:"",lines:[[]]},index:{lines:[]},search:{active:!1,regexp:!1,mode:app.config.search_mode,string:"",results:[],activeResult:0},selection:{set:!1,start:!1,x1:0,y1:0,x2:0,y2:0},numbers:{set:app.config.show_line_numbers,width:0},content_list:{path:"",active:!1},hash_timeout:null,top_bar_shown:!0}}},{}],34:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function UI(app){(0,_classCallCheck2.default)(this,UI),this.app=app}var _updateFileList;return(0,_createClass2.default)(UI,[{key:"setWindowTitle",value:function(fileName){document.title=fileName+" - "+this.app.config.app_full_name}},{key:"showGotoLinePrompt",value:function(){var userInput=prompt("Enter line number",this.app.scroll.y);null!=userInput&&(userInput=parseInt(userInput),isNaN(userInput)?this.app.alert("Incorrect line number!"):(this.app.scroll.y=userInput,this.app.render.update()))}},{key:"updateFileList",value:(_updateFileList=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(){var el,list,displayStyle;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return el=document.getElementById("file-list"),_context.next=3,this.app.files.getFileList();case 3:_context.t0=function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())},list=_context.sent.sort(_context.t0),el.innerHTML="",list.forEach(function(filename){var o=document.createElement("option");o.textContent=filename,el.appendChild(o)}),displayStyle=list.length?"inline-block":"none",["file-list","button-load","button-delete"].forEach(function(e){document.getElementById(e).style.display=displayStyle});case 9:case"end":return _context.stop()}},_callee,this)})),function(){return _updateFileList.apply(this,arguments)})},{key:"updateBottomBlock",value:function(){document.getElementById("line-number").textContent=this.app.scroll.y,document.getElementById("line-count").textContent=this.app.state.file.lines.length-1}},{key:"duplicateWindow",value:function(){window.open(document.location.href,"_blank")}}]),UI}()},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10}],35:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));module.exports=function(){function URIHashControl(app){(0,_classCallCheck2.default)(this,URIHashControl),this.app=app}var _load,_process;return(0,_createClass2.default)(URIHashControl,[{key:"set",value:function(newURLHash){var _this=this,updateFunction=function(){newURLHash?history.replaceState?history.replaceState(void 0,void 0,"#"+newURLHash):location.hash="#"+newURLHash:history.pushState("",document.title,window.location.pathname),_this.app.state.hash_timeout=null};this.app.state.hash_timeout?(clearTimeout(this.app.state.hash_timeout),this.app.state.hash_timeout=setTimeout(updateFunction,this.app.config.uri_hash_update_delay)):(updateFunction(),this.app.state.hash_timeout=setTimeout(function(){_this.app.state.hash_timeout=null},this.app.config.uri_hash_update_delay))}},{key:"update",value:function(){var newURLHash="";this.app.state.file.remote_name?newURLHash="remote:"+this.app.state.file.remote_name+":"+this.app.scroll.y:this.app.state.file.name&&(newURLHash="local:"+this.app.state.file.name+":"+this.app.scroll.y),this.set(newURLHash)}},{key:"process",value:(_process=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(hash){var parsedHash,line,file,type,_this$app,scroll,state,config,ui,files,baseName;return _regenerator.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(null===(parsedHash=this.parseHash(hash)))return this.set(this.getCurrent()),_context.abrupt("return");_context.next=4;break;case 4:if(line=parsedHash.line,file=parsedHash.file,type=parsedHash.type,_this$app=this.app,scroll=_this$app.scroll,state=_this$app.state,config=_this$app.config,ui=_this$app.ui,files=_this$app.files,scroll.y!=line&&(scroll.y=line),"remote"==type&&state.file.remote_name!=file)return _context.prev=8,_context.next=11,files.loadRemote(config.content_real_path+file,file);_context.next=22;break;case 11:baseName=file.split(/[\\/]/).pop(),ui.setWindowTitle(baseName),state.file.name=baseName,state.file.remote_name=file,state.content_list.path=file.substr(0,file.length-baseName.length-1),scroll.y=line,_context.next=22;break;case 19:_context.prev=19,_context.t0=_context.catch(8),this.app.alert("Couldn't load remote file!");case 22:case"end":return _context.stop()}},_callee,this,[[8,19]])})),function(_x){return _process.apply(this,arguments)})},{key:"load",value:(_load=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee2(parsed){var baseName,path,message,_this2=this;return _regenerator.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if("remote"==parsed.type)return baseName=parsed.file.split(/[\\/]/).pop(),path=parsed.file.substr(0,parsed.file.length-baseName.length-1),this.app.state.content_list.path=path,_context2.next=6,this.app.files.loadRemote(this.app.config.content_real_path+parsed.file,parsed.file).then(function(){_this2.app.ui.setWindowTitle(baseName),_this2.app.state.file.name=baseName,_this2.app.scroll.y=parsed.line}).catch(function(err){_this2.app.alert("Couldn't load remote file!")});_context2.next=9;break;case 6:return _context2.abrupt("return",_context2.sent);case 9:if("local"==parsed.type)return _context2.next=12,this.app.files.loadLocal(parsed.file).then(function(){return _this2.app.scroll.y=parsed.line,_this2.update()});_context2.next=15;break;case 12:return _context2.abrupt("return",_context2.sent);case 15:throw message="UriHashControl.load: incorrect URI hash value!",this.app.alert(message),new Error(message);case 18:case"end":return _context2.stop()}},_callee2,this)})),function(_x2){return _load.apply(this,arguments)})},{key:"getCurrent",value:function(){var curHash="";return this.app.state.file.name&&(curHash=(this.app.state.file.remote_name?"remote:"+this.app.state.file.remote_name:"local:"+this.app.state.file.name)+":"+this.app.scroll.y),curHash}},{key:"parseHash",value:function(hash){var parts=decodeURIComponent(hash).substr(1).split(":"),type=parts.shift(),line=parseInt(parts.pop());return!["remote","local"].includes(type)||isNaN(line)?null:{line:line,file:parts.join(":"),type:type}}}]),URIHashControl}()},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":3,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":5,"@babel/runtime/regenerator":10}]},{},[24]);